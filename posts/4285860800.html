<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Vueçš„è™šæ‹ŸDOM | Nightwishã®blogğŸ§Š</title><meta name="keywords" content="è™šæ‹ŸDOM"><meta name="author" content="é£å„¿"><meta name="copyright" content="é£å„¿"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Vueçš„è™šæ‹ŸDOMï¼Œè¿˜æœ‰å…„å¼Ÿç¯‡Reactçš„è™šæ‹ŸDOM">
<meta property="og:type" content="article">
<meta property="og:title" content="Vueçš„è™šæ‹ŸDOM">
<meta property="og:url" content="https://mynightwish.online/posts/4285860800.html">
<meta property="og:site_name" content="Nightwishã®blogğŸ§Š">
<meta property="og:description" content="Vueçš„è™šæ‹ŸDOMï¼Œè¿˜æœ‰å…„å¼Ÿç¯‡Reactçš„è™šæ‹ŸDOM">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://images.unsplash.com/photo-1639327771356-e2bde8814883?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1333&q=80">
<meta property="article:published_time" content="2021-12-13T07:43:57.000Z">
<meta property="article:modified_time" content="2023-01-17T11:47:30.984Z">
<meta property="article:author" content="é£å„¿">
<meta property="article:tag" content="è™šæ‹ŸDOM">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://images.unsplash.com/photo-1639327771356-e2bde8814883?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1333&q=80"><link rel="shortcut icon" href="/img/favicon.webp"><link rel="canonical" href="https://mynightwish.online/posts/4285860800"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?41dc163acde19f0f2684b23f1468c5dc";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":false,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Vueçš„è™šæ‹ŸDOM',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-01-17 19:47:30'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    document.addEventListener('pjax:complete', detectApple)})(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/double.css"><link rel="stylesheet" href="/css/beautify.css" media="async"><link rel="stylesheet" href="/css/progress_bar.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css"  media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/lastLoad.css" media="defer" onload="this.media='all'"><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="blurNum"></style><style id="settingStyle"></style><span id="fps"></span><style id="defineBg"></style><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_3859043_rw1ayonelb.css" media="defer" onload="this.media='all'"><script async src="https://cdn.jsdelivr.net/npm/echarts@4.9.0/dist/echarts.min.js"></script><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/css/swiperFix.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"><style>#web_bg{
  background: var(--default-bg);
  background-attachment: local;
  background-position: center;
  background-size: cover;
  background-repeat: no-repeat;
}
[data-theme="dark"]
  #web_bg{
    background: var(--darkmode-bg) !important;
    background-attachment: local!important;
    background-position: center!important;
    background-size: cover!important;
    background-repeat: no-repeat!important;
  }
</style></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avartor.webp" onerror="onerror=null;src='https://mynightwish.oss-cn-beijing.aliyuncs.com/staticResource/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">112</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">91</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">12</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw icon-food-strawberry"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-food-strawberry"></use></svg><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><i class="fa-fw icon-food-popsicle"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-food-popsicle"></use></svg><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-food-doughnut"></use></svg><span> è¶³è¿¹</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/charts/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xiangjiB">                   </use></svg><span> æ–‡ç« </span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-diannaoB"></use></svg><span> åª’ä½“</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-erjiB">                   </use></svg><span> éŸ³ä¹</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/movies/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-dianshijiB">                   </use></svg><span> è§†é¢‘</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/books/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shouyinjiB">                   </use></svg><span> ä¹¦ç±</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><i class="fa-fw icon-food-macaron"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-food-macaron"></use></svg><span> ç•™è¨€æ¿</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://images.unsplash.com/photo-1639327771356-e2bde8814883?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1333&amp;q=80')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Nightwishã®blogğŸ§Š</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw icon-food-strawberry"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-food-strawberry"></use></svg><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><i class="fa-fw icon-food-popsicle"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-food-popsicle"></use></svg><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-food-doughnut"></use></svg><span> è¶³è¿¹</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/charts/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xiangjiB">                   </use></svg><span> æ–‡ç« </span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-diannaoB"></use></svg><span> åª’ä½“</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-erjiB">                   </use></svg><span> éŸ³ä¹</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/movies/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-dianshijiB">                   </use></svg><span> è§†é¢‘</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/books/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shouyinjiB">                   </use></svg><span> ä¹¦ç±</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><i class="fa-fw icon-food-macaron"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-food-macaron"></use></svg><span> ç•™è¨€æ¿</span></a></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()"></a></center><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="æ£€ç´¢ç«™å†…ä»»ä½•ä½ æƒ³è¦çš„ä¿¡æ¯"><svg class="faa-tada icon" style="height:28px;width:28px;fill:currentColor;position:relative;" aria-hidden="true"><use xlink:href="#icon-sousuo"></use></svg><span> search.title</span></a></div><a class="meihua faa-parent animated-hover" onclick="toggleWinbox()" title="ç¾åŒ–è®¾ç½®-è‡ªå®šä¹‰ä½ çš„é£æ ¼" id="meihua-button"><svg class="faa-tada icon" style="height:28px;width:28px;fill:currentColor;position:relative;margin-left:25px;margin-right:25px;" aria-hidden="true"><use xlink:href="#icon-food-cookie"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢" id="nightmode-button"><svg class="faa-tada" style="height:28px;width:28px;fill:currentColor;position:relative;" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-xiuxi">        </use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">Vueçš„è™šæ‹ŸDOM</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2021-12-13T07:43:57.000Z" title="å‘è¡¨äº 2021-12-13 15:43:57">2021-12-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-01-17T11:47:30.984Z" title="æ›´æ–°äº 2023-01-17 19:47:30">2023-01-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/1-4-%E6%A1%86%E6%9E%B6/">1.4-æ¡†æ¶</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">7178</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>30åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Vueçš„è™šæ‹ŸDOM"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="è™šæ‹ŸDOM">è™šæ‹ŸDOM<a class="anchor" href="#è™šæ‹ŸDOM">Â·</a></h1>
<ul>
<li>
<h3 id="è„‰ç»œï¼šä»åˆå§‹åŒ–-Vue-åˆ°æœ€ç»ˆæ¸²æŸ“çš„æ•´ä¸ªè¿‡ç¨‹">è„‰ç»œï¼šä»åˆå§‹åŒ– <code>Vue</code> åˆ°æœ€ç»ˆæ¸²æŸ“çš„æ•´ä¸ªè¿‡ç¨‹<a class="anchor" href="#è„‰ç»œï¼šä»åˆå§‹åŒ–-Vue-åˆ°æœ€ç»ˆæ¸²æŸ“çš„æ•´ä¸ªè¿‡ç¨‹">Â·</a></h3>
<img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e2486c7e0ed7?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img" style="zoom: 67%;" />
</li>
<li>
<p>ä»€ä¹ˆæ˜¯<code>Virtual DOM</code></p>
</li>
<li>
<p>ä¸ºä»€ä¹ˆéœ€è¦ <code>Virtual DOM</code></p>
</li>
<li>
<p>ä»¥åŠ <code>Virtual DOM</code>çš„å…·ä½“å®ç°</p>
</li>
</ul>
<h2 id="ä¸€ã€çœŸå®DOMå’Œå…¶è§£ææµç¨‹">ä¸€ã€çœŸå®<code>DOM</code>å’Œå…¶è§£ææµç¨‹<a class="anchor" href="#ä¸€ã€çœŸå®DOMå’Œå…¶è§£ææµç¨‹">Â·</a></h2>
<p>ä¸‹å›¾ä¸º <code>webkit</code> æ¸²æŸ“å¼•æ“å·¥ä½œæµç¨‹å›¾</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e10922325215?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<p>æ‰€æœ‰çš„æµè§ˆå™¨æ¸²æŸ“å¼•æ“å·¥ä½œæµç¨‹å¤§è‡´åˆ†ä¸º5æ­¥ï¼šåˆ›å»º <code>DOM</code> æ ‘ â€”&gt; åˆ›å»º <code>Style Rules</code> -&gt; æ„å»º <code>Render</code> æ ‘ â€”&gt; å¸ƒå±€ <code>Layout</code> -â€”&gt; ç»˜åˆ¶ <code>Painting</code>ã€‚</p>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼Œæ„å»º DOM æ ‘ï¼šç”¨ HTML åˆ†æå™¨ï¼Œåˆ†æ HTML å…ƒç´ ï¼Œæ„å»ºä¸€æ£µ DOM æ ‘ï¼›</li>
<li>ç¬¬äºŒæ­¥ï¼Œç”Ÿæˆæ ·å¼è¡¨ï¼šç”¨ CSS åˆ†æå™¨ï¼Œåˆ†æ CSS æ–‡ä»¶å’Œå…ƒç´ ä¸Šçš„ inline æ ·å¼ï¼Œç”Ÿæˆé¡µé¢çš„æ ·å¼è¡¨ï¼›</li>
<li>ç¬¬ä¸‰æ­¥ï¼Œæ„å»º Render æ ‘ï¼šå°† DOM æ ‘å’Œæ ·å¼è¡¨å…³è”èµ·æ¥ï¼Œæ„å»ºä¸€æ£µ Render æ ‘ï¼ˆAttachmentï¼‰ã€‚æ¯ä¸ª DOM èŠ‚ç‚¹éƒ½æœ‰ attach æ–¹æ³•ï¼Œæ¥å—æ ·å¼ä¿¡æ¯ï¼Œè¿”å›ä¸€ä¸ª render å¯¹è±¡ï¼ˆåˆå rendererï¼‰ï¼Œè¿™äº› render å¯¹è±¡æœ€ç»ˆä¼šè¢«æ„å»ºæˆä¸€æ£µ Render æ ‘ï¼›</li>
<li>ç¬¬å››æ­¥ï¼Œç¡®å®šèŠ‚ç‚¹åæ ‡ï¼šæ ¹æ® Render æ ‘ç»“æ„ï¼Œä¸ºæ¯ä¸ª Render æ ‘ä¸Šçš„èŠ‚ç‚¹ç¡®å®šä¸€ä¸ªåœ¨æ˜¾ç¤ºå±ä¸Šå‡ºç°çš„ç²¾ç¡®åæ ‡ï¼›</li>
<li>ç¬¬äº”æ­¥ï¼Œç»˜åˆ¶é¡µé¢ï¼šæ ¹æ® Render æ ‘å’ŒèŠ‚ç‚¹æ˜¾ç¤ºåæ ‡ï¼Œç„¶åè°ƒç”¨æ¯ä¸ªèŠ‚ç‚¹çš„ paint æ–¹æ³•ï¼Œå°†å®ƒä»¬ç»˜åˆ¶å‡ºæ¥ã€‚</li>
</ul>
<p><strong>æ³¨æ„ç‚¹ï¼š</strong></p>
<p><strong>1ã€<code>DOM</code> æ ‘çš„æ„å»ºæ˜¯æ–‡æ¡£åŠ è½½å®Œæˆå¼€å§‹çš„ï¼Ÿ</strong></p>
<p>â€‹	æ„å»º <code>DOM</code> æ ‘æ˜¯ä¸€ä¸ªæ¸è¿›è¿‡ç¨‹ï¼Œä¸ºè¾¾åˆ°æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæ¸²æŸ“å¼•æ“ä¼šå°½å¿«å°†å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œå®ƒä¸å¿…ç­‰åˆ°æ•´ä¸ª <code>HTML</code> æ–‡æ¡£è§£æå®Œæˆä¹‹åæ‰å¼€å§‹æ„å»º <code>render</code> æ ‘å’Œå¸ƒå±€ã€‚</p>
<p><strong>2ã€<code>Render</code> æ ‘æ˜¯ <code>DOM</code> æ ‘å’Œ <code>CSS</code> æ ·å¼è¡¨æ„å»ºå®Œæ¯•åæ‰å¼€å§‹æ„å»ºçš„ï¼Ÿ</strong></p>
<p>â€‹	è¿™ä¸‰ä¸ªè¿‡ç¨‹åœ¨å®é™…è¿›è¡Œçš„æ—¶å€™å¹¶ä¸æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œè€Œæ˜¯ä¼šæœ‰äº¤å‰ï¼Œä¼šä¸€è¾¹åŠ è½½ï¼Œä¸€è¾¹è§£æï¼Œä»¥åŠä¸€è¾¹æ¸²æŸ“ã€‚</p>
<p><strong>3ã€<code>CSS</code> çš„è§£ææ³¨æ„ç‚¹ï¼Ÿ</strong></p>
<p>â€‹	<code>CSS</code> çš„è§£ææ˜¯ä»å³å¾€å·¦é€†å‘è§£æçš„ï¼ŒåµŒå¥—æ ‡ç­¾è¶Šå¤šï¼Œè§£æè¶Šæ…¢ã€‚</p>
<p><strong>4ã€<code>JS</code> æ“ä½œçœŸå® <code>DOM</code> çš„ä»£ä»·ï¼Ÿ</strong></p>
<ul>
<li>ä¼ ç»Ÿçš„å¼€å‘æ¨¡å¼ï¼šåŸç”Ÿ <code>JS</code> æ“ä½œ <code>DOM</code> æ—¶ï¼Œæµè§ˆå™¨ä¼šä»æ„å»º DOM æ ‘å¼€å§‹ä»å¤´åˆ°å°¾æ‰§è¡Œä¸€éæµç¨‹ã€‚åœ¨ä¸€æ¬¡æ“ä½œä¸­ï¼Œæˆ‘éœ€è¦æ›´æ–° 10 ä¸ª <code>DOM</code> èŠ‚ç‚¹ï¼Œæµè§ˆå™¨æ”¶åˆ°ç¬¬ä¸€ä¸ª <code>DOM</code> è¯·æ±‚åå¹¶ä¸çŸ¥é“è¿˜æœ‰ 9 æ¬¡æ›´æ–°æ“ä½œï¼Œå› æ­¤ä¼šé©¬ä¸Šæ‰§è¡Œæµç¨‹ï¼Œæœ€ç»ˆæ‰§è¡Œ10 æ¬¡ã€‚</li>
<li>ä¾‹å¦‚ï¼Œç¬¬ä¸€æ¬¡è®¡ç®—å®Œï¼Œç´§æ¥ç€ä¸‹ä¸€ä¸ª <code>DOM</code> æ›´æ–°è¯·æ±‚ï¼Œè¿™ä¸ªèŠ‚ç‚¹çš„åæ ‡å€¼å°±å˜äº†ï¼Œå‰ä¸€æ¬¡è®¡ç®—ä¸ºæ— ç”¨åŠŸã€‚è®¡ç®— <code>DOM</code> èŠ‚ç‚¹åæ ‡å€¼ç­‰éƒ½æ˜¯ç™½ç™½æµªè´¹çš„æ€§èƒ½ã€‚å³ä½¿è®¡ç®—æœºç¡¬ä»¶ä¸€ç›´åœ¨è¿­ä»£æ›´æ–°ï¼Œæ“ä½œ <code>DOM</code> çš„ä»£ä»·ä»æ—§æ˜¯æ˜‚è´µçš„ï¼Œé¢‘ç¹æ“ä½œè¿˜æ˜¯ä¼šå‡ºç°é¡µé¢å¡é¡¿ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ</li>
</ul>
<h2 id="äºŒã€Virtual-DOM-åŸºç¡€">äºŒã€<code>Virtual-DOM</code> åŸºç¡€<a class="anchor" href="#äºŒã€Virtual-DOM-åŸºç¡€">Â·</a></h2>
<h3 id="2-1ã€è™šæ‹Ÿ-DOM-çš„å¥½å¤„">2.1ã€è™šæ‹Ÿ <code>DOM</code> çš„å¥½å¤„<a class="anchor" href="#2-1ã€è™šæ‹Ÿ-DOM-çš„å¥½å¤„">Â·</a></h3>
<ul>
<li>ä¸ºäº†è§£å†³æµè§ˆå™¨æ€§èƒ½é—®é¢˜è€Œè¢«è®¾è®¡å‡ºæ¥çš„</li>
<li>è‹¥ä¸€æ¬¡æ“ä½œä¸­æœ‰ 10 æ¬¡æ›´æ–° <code>DOM</code> çš„åŠ¨ä½œï¼Œè™šæ‹Ÿ <code>DOM</code> ä¸ä¼šç«‹å³æ“ä½œ <code>DOM</code>ï¼Œè€Œæ˜¯å°†è¿™ 10 æ¬¡æ›´æ–°çš„ <code>diff</code> å†…å®¹ä¿å­˜åˆ°æœ¬åœ°ä¸€ä¸ª <code>JS</code> å¯¹è±¡ä¸­ï¼Œæœ€ç»ˆå°†è¿™ä¸ª <code>JS</code> å¯¹è±¡ä¸€æ¬¡æ€§ <code>attch</code> åˆ° <code>DOM</code> æ ‘ä¸Šï¼Œå†è¿›è¡Œåç»­æ“ä½œï¼Œé¿å…å¤§é‡æ— è°“çš„è®¡ç®—é‡</li>
<li>å¥½å¤„æ˜¯ï¼Œé¡µé¢çš„æ›´æ–°å¯ä»¥å…ˆå…¨éƒ¨åæ˜ åœ¨ <code>JS</code> å¯¹è±¡(è™šæ‹Ÿ <code>DOM</code> )ä¸Šï¼Œæ“ä½œå†…å­˜ä¸­çš„ <code>JS</code> å¯¹è±¡çš„é€Ÿåº¦æ˜¾ç„¶è¦æ›´å¿«ï¼Œç­‰æ›´æ–°å®Œæˆåï¼Œå†å°†æœ€ç»ˆçš„ <code>JS</code> å¯¹è±¡æ˜ å°„æˆçœŸå®çš„ <code>DOM</code>ï¼Œäº¤ç”±æµè§ˆå™¨å»ç»˜åˆ¶ã€‚</li>
</ul>
<h3 id="2-2ã€ç®—æ³•å®ç°">2.2ã€ç®—æ³•å®ç°<a class="anchor" href="#2-2ã€ç®—æ³•å®ç°">Â·</a></h3>
<h4 id="2-2-1ã€ç”¨-JS-å¯¹è±¡æ¨¡æ‹Ÿ-DOM-æ ‘">2.2.1ã€ç”¨ <code>JS</code> å¯¹è±¡æ¨¡æ‹Ÿ <code>DOM</code> æ ‘<a class="anchor" href="#2-2-1ã€ç”¨-JS-å¯¹è±¡æ¨¡æ‹Ÿ-DOM-æ ‘">Â·</a></h4>
<h5 id="ï¼ˆ1ï¼‰å¦‚ä½•ç”¨-JS-å¯¹è±¡æ¨¡æ‹Ÿ-DOM-æ ‘ï¼Ÿ"><strong>ï¼ˆ1ï¼‰å¦‚ä½•ç”¨ <code>JS</code> å¯¹è±¡æ¨¡æ‹Ÿ <code>DOM</code> æ ‘ï¼Ÿ</strong><a class="anchor" href="#ï¼ˆ1ï¼‰å¦‚ä½•ç”¨-JS-å¯¹è±¡æ¨¡æ‹Ÿ-DOM-æ ‘ï¼Ÿ">Â·</a></h5>
<ul>
<li>
<p><strong>åšæ³•ï¼š<strong>è°ƒç”¨</strong>createElement</strong>å‡½æ•°ï¼šå†…éƒ¨å®ä¾‹åŒ–<strong>Element</strong>ç±»ï¼Œå¹¶åœ¨å®ä¾‹åŒ–æ—¶å°†å‚æ•°ä¼ å…¥</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Element</span>(<span class="params">tagName, props, children</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tagName</span> = tagName</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">props</span> = props</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">children</span> = children</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(props.<span class="property">key</span>)&#123;  <span class="comment">// dom å…ƒç´ çš„ key å€¼ï¼Œç”¨ä½œå”¯ä¸€æ ‡è¯†ç¬¦</span></span><br><span class="line">       <span class="variable language_">this</span>.<span class="property">key</span> = props.<span class="property">key</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span></span><br><span class="line">    children.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">child, i</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (child <span class="keyword">instanceof</span> <span class="title class_">Element</span>) &#123;</span><br><span class="line">            count += child.<span class="property">count</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            children[i] = <span class="string">&#x27;&#x27;</span> + child</span><br><span class="line">        &#125;</span><br><span class="line">        count++</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// å­å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">count</span> = count</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createElement</span>(<span class="params">tagName, props, children</span>)&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Element</span>(tagName, props, children);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = createElement;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¾‹å¦‚ï¼šä¸€ä¸ªçœŸå®çš„ <code>DOM</code> èŠ‚ç‚¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;virtual-dom&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Virtual DOM<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span>Item 1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span>Item 2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span>Item 3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt; </span><br></pre></td></tr></table></figure>
<p>æ ¹æ® <code>element</code> å¯¹è±¡çš„è®¾å®šï¼Œåˆ™ä¸Šé¢çš„ <code>DOM</code> ç»“æ„å°±å¯ä»¥ç®€å•è¡¨ç¤ºä¸ºï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> el = <span class="built_in">require</span>(<span class="string">&quot;./element.js&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> ul = <span class="title function_">el</span>(<span class="string">&#x27;div&#x27;</span>, &#123;<span class="attr">id</span>:<span class="string">&#x27;virtual-dom&#x27;</span>&#125;,[</span><br><span class="line">  <span class="title function_">el</span>(<span class="string">&#x27;p&#x27;</span>,&#123;&#125;,[<span class="string">&#x27;Virtual DOM&#x27;</span>]),</span><br><span class="line">  <span class="title function_">el</span>(<span class="string">&#x27;ul&#x27;</span>, &#123; <span class="attr">id</span>: <span class="string">&#x27;list&#x27;</span> &#125;, [</span><br><span class="line">	<span class="title function_">el</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;item&#x27;</span> &#125;, [<span class="string">&#x27;Item 1&#x27;</span>]),</span><br><span class="line">	<span class="title function_">el</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;item&#x27;</span> &#125;, [<span class="string">&#x27;Item 2&#x27;</span>]),</span><br><span class="line">	<span class="title function_">el</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;item&#x27;</span> &#125;, [<span class="string">&#x27;Item 3&#x27;</span>])</span><br><span class="line">  ]),</span><br><span class="line">  <span class="title function_">el</span>(<span class="string">&#x27;div&#x27;</span>,&#123;&#125;,[<span class="string">&#x27;Hello World&#x27;</span>])</span><br><span class="line">]) </span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ <code>ul</code> å°±æ˜¯æˆ‘ä»¬ç”¨ <code>JavaScript</code> å¯¹è±¡è¡¨ç¤ºçš„ <code>DOM</code> ç»“æ„ï¼Œæˆ‘ä»¬è¾“å‡ºæŸ¥çœ‹ <code>ul</code> å¯¹åº”çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e14fcff074f0?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
</li>
</ul>
<h5 id="ï¼ˆ2ï¼‰æ¸²æŸ“ç”¨-JS-è¡¨ç¤ºçš„-DOM-å¯¹è±¡"><strong>ï¼ˆ2ï¼‰æ¸²æŸ“ç”¨ <code>JS</code> è¡¨ç¤ºçš„ <code>DOM</code> å¯¹è±¡</strong><a class="anchor" href="#ï¼ˆ2ï¼‰æ¸²æŸ“ç”¨-JS-è¡¨ç¤ºçš„-DOM-å¯¹è±¡">Â·</a></h5>
<p>æ­¤æ—¶é¡µé¢ä¸Šå¹¶æ²¡æœ‰è¿™ä¸ªç»“æ„ï¼Œå¦‚ä½•å°† <code>ul</code> æ¸²æŸ“æˆé¡µé¢ä¸ŠçœŸå®çš„ <code>DOM</code> ç»“æ„ï¼Ÿ</p>
<ul>
<li>
<p>**åšæ³•ï¼š**è°ƒç”¨ElementåŸå‹ä¸Šé¢çš„renderå‡½æ•°ï¼Œä¼šæ ¹æ® <code>tagName</code> æ„å»ºä¸€ä¸ªçœŸæ­£çš„ <code>DOM</code> èŠ‚ç‚¹ï¼Œç„¶åè®¾ç½®è¿™ä¸ªèŠ‚ç‚¹çš„å±æ€§ï¼Œæœ€åé€’å½’åœ°æŠŠè‡ªå·±çš„å­èŠ‚ç‚¹ä¹Ÿæ„å»ºèµ·æ¥</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// render å°†virdual-dom å¯¹è±¡æ¸²æŸ“ä¸ºå®é™… DOM å…ƒç´ </span></span><br><span class="line"><span class="title class_">Element</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">render</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> el = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="variable language_">this</span>.<span class="property">tagName</span>)</span><br><span class="line">    <span class="keyword">var</span> props = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line">    <span class="comment">// è®¾ç½®èŠ‚ç‚¹çš„DOMå±æ€§</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> propName <span class="keyword">in</span> props) &#123;</span><br><span class="line">        <span class="keyword">var</span> propValue = props[propName]</span><br><span class="line">        el.<span class="title function_">setAttribute</span>(propName, propValue)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> children = <span class="variable language_">this</span>.<span class="property">children</span> || []</span><br><span class="line">    children.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">child</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> childEl = (child <span class="keyword">instanceof</span> <span class="title class_">Element</span>)</span><br><span class="line">            ? child.<span class="title function_">render</span>() <span class="comment">// å¦‚æœå­èŠ‚ç‚¹ä¹Ÿæ˜¯è™šæ‹ŸDOMï¼Œé€’å½’æ„å»ºDOMèŠ‚ç‚¹</span></span><br><span class="line">            : <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(child) <span class="comment">// å¦‚æœå­—ç¬¦ä¸²ï¼Œåªæ„å»ºæ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">        el.<span class="title function_">appendChild</span>(childEl)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> el</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ¥ä¸Šé¢çš„ä¾‹å­ï¼šå°†æ„å»ºå¥½çš„ <code>DOM</code> ç»“æ„æ·»åŠ åˆ°é¡µé¢ <code>body</code> ä¸Šé¢</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ulRoot = ul.<span class="title function_">render</span>();</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(ulRoot);</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œé¡µé¢ <code>body</code> é‡Œé¢å°±æœ‰çœŸæ­£çš„ <code>DOM</code> ç»“æ„ï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e179a748d425?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img" style="zoom:50%;" />
</li>
</ul>
<h4 id="2-2-2ã€æ¯”è¾ƒä¸¤æ£µè™šæ‹Ÿ-DOM-æ ‘çš„å·®å¼‚-â€”-diff-ç®—æ³•">2.2.2ã€æ¯”è¾ƒä¸¤æ£µè™šæ‹Ÿ <code>DOM</code> æ ‘çš„å·®å¼‚ â€” <code>diff</code> ç®—æ³•<a class="anchor" href="#2-2-2ã€æ¯”è¾ƒä¸¤æ£µè™šæ‹Ÿ-DOM-æ ‘çš„å·®å¼‚-â€”-diff-ç®—æ³•">Â·</a></h4>
<ul>
<li>
<p>å¤æ‚åº¦ï¼š</p>
<ul>
<li>
<p>å¦‚æœéœ€è¦ä¸¤æ£µæ ‘çš„å®Œå…¨æ¯”è¾ƒï¼Œæ—¶é—´å¤æ‚åº¦ä¸º<code>O(n^3)</code>ã€‚</p>
</li>
<li>
<p>ä½†æ˜¯åœ¨å‰ç«¯å½“ä¸­ï¼Œä½ å¾ˆå°‘ä¼šè·¨è¶Šå±‚çº§åœ°ç§»åŠ¨ <code>DOM</code> å…ƒç´ ï¼Œæ‰€ä»¥ <code>Virtual DOM</code> åªä¼šå¯¹åŒä¸€ä¸ªå±‚çº§çš„å…ƒç´ è¿›è¡Œå¯¹æ¯”</p>
</li>
<li>
<p>è¿™æ ·ç®—æ³•å¤æ‚åº¦å°±å¯ä»¥è¾¾åˆ° <code>O(n)</code>ã€‚</p>
</li>
</ul>
</li>
</ul>
<img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e26a5ecf086e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img" style="zoom: 33%;" />
<h5 id="ï¼ˆ1ï¼‰æ·±åº¦ä¼˜å…ˆéå†ï¼Œè®°å½•å·®å¼‚"><strong>ï¼ˆ1ï¼‰æ·±åº¦ä¼˜å…ˆéå†ï¼Œè®°å½•å·®å¼‚</strong><a class="anchor" href="#ï¼ˆ1ï¼‰æ·±åº¦ä¼˜å…ˆéå†ï¼Œè®°å½•å·®å¼‚">Â·</a></h5>
<ul>
<li>å¯¹<strong>æ–°æ—§ä¸¤æ£µæ ‘</strong>è¿›è¡Œä¸€ä¸ªæ·±åº¦ä¼˜å…ˆçš„éå†ï¼Œæ¯éå†åˆ°ä¸€ä¸ªèŠ‚ç‚¹å°±æŠŠè¯¥èŠ‚ç‚¹å’Œæ–°çš„çš„æ ‘è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœæœ‰å·®å¼‚çš„è¯å°±è®°å½•åˆ°ä¸€ä¸ªå¯¹è±¡é‡Œé¢ã€‚è¿™æ ·æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è®°ï¼š</li>
</ul>
<img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e0e2873e42b1?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="dfs-walk" style="zoom: 33%;" />
<ul>
<li>
<p><strong>diffå‡½æ•° â€”&gt; dfsWalkå‡½æ•°ï¼š</strong></p>
<ol>
<li>
<p>åˆ¤æ–­æ–°æ—§èŠ‚ç‚¹æ˜¯å¦éƒ½æ˜¯stringç±»å‹ï¼šæ˜¯ï¼Œæ¯”è¾ƒæ–°æ—§æ–‡æœ¬å†…å®¹æ˜¯å¦ç›¸ç­‰ï¼Ÿ</p>
<ul>
<li>å¦ï¼šcurrentPatchæ•°ç»„ä¸­pushä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå†…éƒ¨æ ‡è®°ä¸ºTextç±»å‹ï¼Œå®ç°æ›¿æ¢æ–‡æœ¬å†…å®¹</li>
</ul>
</li>
<li>
<p>å¦åˆ™ï¼Œæ ‡ç­¾å+keyå€¼æ˜¯å¦å‡ç›¸åŒï¼šæ˜¯ï¼Œè°ƒç”¨diffPropsæ¯”è¾ƒèŠ‚ç‚¹å±æ€§æ˜¯å¦ç›¸ç­‰ï¼Ÿ</p>
<ul>
<li>å¦ï¼šcurrentPatché‡Œpushä¸€ä¸ªå¯¹è±¡(å°†æ–°èŠ‚ç‚¹çš„å±æ€§æ›¿æ¢æ—§èŠ‚ç‚¹å±æ€§)</li>
<li>æ˜¯ï¼ˆç›¸ç­‰ï¼‰ï¼šæ¯”è¾ƒæ²¡æœ‰ignoreå±æ€§çš„å­èŠ‚ç‚¹ï¼šdiffChildrenï¼Œä¼ å…¥èŠ‚ç‚¹çš„children</li>
</ul>
</li>
<li>
<p>å¦åˆ™ï¼Œå¦‚æœæ–°èŠ‚ç‚¹ä¸ä¸ºç©ºï¼š</p>
<p>currentPatchæ•°ç»„ä¸­pushä¸€ä¸ªå¯¹è±¡ï¼Œç±»å‹ä¸ºREPLACEï¼Œå°†æ¥ç›´æ¥æ›¿æ¢</p>
</li>
<li>
<p>å‡½æ•°æœ€åï¼š</p>
<p>å°†currentPatchæ•°ç»„èµ‹å€¼ç»™patcheså¯¹è±¡ä¸Šï¼Œpatchesè¿™ä¸ªå¯¹è±¡å°±è®°å½•äº†æ‰€æœ‰èŠ‚ç‚¹çš„å·®å¼‚</p>
</li>
</ol>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// diff å‡½æ•°ï¼Œå¯¹æ¯”ä¸¤æ£µæ ‘</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">diff</span>(<span class="params">oldTree, newTree</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> index = <span class="number">0</span> <span class="comment">// å½“å‰èŠ‚ç‚¹çš„æ ‡å¿—</span></span><br><span class="line">  <span class="keyword">var</span> patches = &#123;&#125; <span class="comment">// ç”¨æ¥è®°å½•æ¯ä¸ªèŠ‚ç‚¹å·®å¼‚çš„å¯¹è±¡</span></span><br><span class="line">  <span class="title function_">dfsWalk</span>(oldTree, newTree, index, patches)</span><br><span class="line">  <span class="keyword">return</span> patches</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹ä¸¤æ£µæ ‘è¿›è¡Œæ·±åº¦ä¼˜å…ˆéå†</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">dfsWalk</span>(<span class="params">oldNode, newNode, index, patches</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> currentPatch = []</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> (oldNode) === <span class="string">&quot;string&quot;</span> &amp;&amp; <span class="keyword">typeof</span> (newNode) === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// æ–‡æœ¬å†…å®¹æ”¹å˜</span></span><br><span class="line">    <span class="keyword">if</span> (newNode !== oldNode) &#123;</span><br><span class="line">      currentPatch.<span class="title function_">push</span>(&#123; <span class="attr">type</span>: patch.<span class="property">TEXT</span>, <span class="attr">content</span>: newNode &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newNode!=<span class="literal">null</span> &amp;&amp; oldNode.<span class="property">tagName</span> === newNode.<span class="property">tagName</span> &amp;&amp; oldNode.<span class="property">key</span> === newNode.<span class="property">key</span>) &#123;</span><br><span class="line">    <span class="comment">// èŠ‚ç‚¹ç›¸åŒï¼Œæ¯”è¾ƒå±æ€§</span></span><br><span class="line">    <span class="keyword">var</span> propsPatches = <span class="title function_">diffProps</span>(oldNode, newNode)</span><br><span class="line">    <span class="keyword">if</span> (propsPatches) &#123;</span><br><span class="line">      currentPatch.<span class="title function_">push</span>(&#123; <span class="attr">type</span>: patch.<span class="property">PROPS</span>, <span class="attr">props</span>: propsPatches &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ¯”è¾ƒå­èŠ‚ç‚¹ï¼Œå¦‚æœå­èŠ‚ç‚¹æœ‰&#x27;ignore&#x27;å±æ€§ï¼Œåˆ™ä¸éœ€è¦æ¯”è¾ƒ</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">isIgnoreChildren</span>(newNode)) &#123;</span><br><span class="line">      <span class="title function_">diffChildren</span>(</span><br><span class="line">        oldNode.<span class="property">children</span>,</span><br><span class="line">        newNode.<span class="property">children</span>,</span><br><span class="line">        index,</span><br><span class="line">        patches,</span><br><span class="line">        currentPatch</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(newNode !== <span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="comment">// æ–°èŠ‚ç‚¹å’Œæ—§èŠ‚ç‚¹ä¸åŒï¼Œç”¨ replace æ›¿æ¢</span></span><br><span class="line">    currentPatch.<span class="title function_">push</span>(&#123; <span class="attr">type</span>: patch.<span class="property">REPLACE</span>, <span class="attr">node</span>: newNode &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (currentPatch.<span class="property">length</span>) &#123;</span><br><span class="line">    patches[index] = currentPatch</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>ä»ä»¥ä¸Šå¯ä»¥å¾—å‡ºï¼Œ<code>patches[1]</code> è¡¨ç¤º <code>p</code> ï¼Œ<code>patches[3]</code> è¡¨ç¤º <code>ul</code> ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<h5 id="ï¼ˆ2ï¼‰å·®å¼‚ç±»å‹"><strong>ï¼ˆ2ï¼‰å·®å¼‚ç±»å‹</strong><a class="anchor" href="#ï¼ˆ2ï¼‰å·®å¼‚ç±»å‹">Â·</a></h5>
<p><code>DOM</code> æ“ä½œå¯¼è‡´çš„å·®å¼‚ç±»å‹åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>èŠ‚ç‚¹æ›¿æ¢ï¼šèŠ‚ç‚¹æ”¹å˜äº†ï¼Œä¾‹å¦‚å°†ä¸Šé¢çš„ <code>div</code> æ¢æˆ <code>h1</code>;</li>
<li>é¡ºåºäº’æ¢ï¼šç§»åŠ¨ã€åˆ é™¤ã€æ–°å¢å­èŠ‚ç‚¹ï¼Œä¾‹å¦‚ä¸Šé¢ <code>div</code> çš„å­èŠ‚ç‚¹ï¼ŒæŠŠ <code>p</code> å’Œ <code>ul</code> é¡ºåºäº’æ¢ï¼›</li>
<li>å±æ€§æ›´æ”¹ï¼šä¿®æ”¹äº†èŠ‚ç‚¹çš„å±æ€§ï¼Œä¾‹å¦‚æŠŠä¸Šé¢ <code>li</code> çš„ <code>class</code> æ ·å¼ç±»åˆ é™¤ï¼›</li>
<li>æ–‡æœ¬æ”¹å˜ï¼šæ”¹å˜æ–‡æœ¬èŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹ï¼Œä¾‹å¦‚å°†ä¸Šé¢ <code>p</code> èŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹æ›´æ”¹ä¸º â€œ<code>Real Dom</code>â€ï¼›</li>
</ul>
<p>ä»¥ä¸Šæè¿°çš„å‡ ç§å·®å¼‚ç±»å‹åœ¨ä»£ç ä¸­å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">var REPLACE = 0 // æ›¿æ¢åŸå…ˆçš„èŠ‚ç‚¹</span><br><span class="line">var REORDER = 1 // é‡æ–°æ’åº</span><br><span class="line">var PROPS = 2 // ä¿®æ”¹äº†èŠ‚ç‚¹çš„å±æ€§</span><br><span class="line">var TEXT = 3 // æ–‡æœ¬å†…å®¹æ”¹å˜ </span><br></pre></td></tr></table></figure>
<h5 id="ï¼ˆ3ï¼‰åˆ—è¡¨å¯¹æ¯”ç®—æ³•-ä¸è¦ä¸»åŠ¨æ"><strong>ï¼ˆ3ï¼‰åˆ—è¡¨å¯¹æ¯”ç®—æ³•</strong>                   ä¸è¦ä¸»åŠ¨æ<a class="anchor" href="#ï¼ˆ3ï¼‰åˆ—è¡¨å¯¹æ¯”ç®—æ³•-ä¸è¦ä¸»åŠ¨æ">Â·</a></h5>
<ul>
<li>
<p>**é—®é¢˜ï¼š**åŒå±‚çº§äº¤æ¢äº†ä½ç½®ï¼Œå¦‚ä½•æ›´é«˜æ•ˆçš„å¯¹æ¯”ï¼Ÿ</p>
<p>å¦‚æœæŒ‰ç…§åŒå±‚çº§çš„è¯ï¼Œä¼šå…¨éƒ¨è¢«æ›¿æ¢æ‰ï¼Œå¼€é”€å¤§ï¼Œå®é™…åªéœ€è¦ç§»åŠ¨å³å¯ã€‚</p>
<ul>
<li>å°†è¿™ä¸ªé—®é¢˜æŠ½è±¡å‡ºæ¥å…¶å®å°±æ˜¯<strong>å­—ç¬¦ä¸²çš„æœ€å°ç¼–è¾‘è·ç¦»é—®é¢˜</strong>ï¼Œæœ€å¸¸è§çš„è§£å†³æ–¹æ³•æ˜¯ <code>Levenshtein Distance</code> ã€‚å®ƒæ˜¯ä¸€ä¸ªåº¦é‡ä¸¤ä¸ªå­—ç¬¦åºåˆ—ä¹‹é—´å·®å¼‚çš„å­—ç¬¦ä¸²åº¦é‡æ ‡å‡†ï¼Œé€šè¿‡<strong>åŠ¨æ€è§„åˆ’</strong>æ±‚è§£ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º <code>O(M*N)</code></li>
</ul>
</li>
<li>
<p>å…·ä½“æ±‚è§£è¿‡ç¨‹ï¼š</p>
</li>
</ul>
<h5 id="ï¼ˆ4ï¼‰å®ä¾‹è¾“å‡º"><strong>ï¼ˆ4ï¼‰å®ä¾‹è¾“å‡º</strong><a class="anchor" href="#ï¼ˆ4ï¼‰å®ä¾‹è¾“å‡º">Â·</a></h5>
<ul>
<li>ä¸¤ä¸ªè™šæ‹Ÿ <code>DOM</code> å¯¹è±¡å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­ <code>ul1</code> è¡¨ç¤ºåŸæœ‰çš„è™šæ‹Ÿ <code>DOM</code> æ ‘ï¼Œ<code>ul2</code> è¡¨ç¤ºæ”¹å˜åçš„è™šæ‹Ÿ <code>DOM</code> æ ‘</li>
<li>é€šè¿‡å·®å¼‚å¯¹è±¡patchesï¼Œä¸¤ä¸ªè™šæ‹Ÿ <code>DOM</code> å¯¹è±¡ä¹‹é—´è¿›è¡Œäº†å“ªäº›å˜åŒ–ï¼Œä»è€Œæ›´æ”¹åŸå…ˆçš„çœŸå® <code>DOM</code> ç»“æ„ï¼Œä»è€Œå°†é¡µé¢çš„ <code>DOM</code> ç»“æ„è¿›è¡Œæ›´æ”¹</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> ul1 = <span class="title function_">el</span>(<span class="string">&#x27;div&#x27;</span>,&#123;<span class="attr">id</span>:<span class="string">&#x27;virtual-dom&#x27;</span>&#125;,[</span><br><span class="line">  <span class="title function_">el</span>(<span class="string">&#x27;p&#x27;</span>,&#123;&#125;,[<span class="string">&#x27;Virtual DOM&#x27;</span>]),</span><br><span class="line">  <span class="title function_">el</span>(<span class="string">&#x27;ul&#x27;</span>, &#123; <span class="attr">id</span>: <span class="string">&#x27;list&#x27;</span> &#125;, [</span><br><span class="line">	<span class="title function_">el</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;item&#x27;</span> &#125;, [<span class="string">&#x27;Item 1&#x27;</span>]),</span><br><span class="line">	<span class="title function_">el</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;item&#x27;</span> &#125;, [<span class="string">&#x27;Item 2&#x27;</span>]),</span><br><span class="line">	<span class="title function_">el</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;item&#x27;</span> &#125;, [<span class="string">&#x27;Item 3&#x27;</span>])</span><br><span class="line">  ]),</span><br><span class="line">  <span class="title function_">el</span>(<span class="string">&#x27;div&#x27;</span>,&#123;&#125;,[<span class="string">&#x27;Hello World&#x27;</span>])</span><br><span class="line">]) </span><br><span class="line"><span class="keyword">var</span> ul2 = <span class="title function_">el</span>(<span class="string">&#x27;div&#x27;</span>,&#123;<span class="attr">id</span>:<span class="string">&#x27;virtual-dom&#x27;</span>&#125;,[</span><br><span class="line">  <span class="title function_">el</span>(<span class="string">&#x27;p&#x27;</span>,&#123;&#125;,[<span class="string">&#x27;Virtual DOM&#x27;</span>]),</span><br><span class="line">  <span class="title function_">el</span>(<span class="string">&#x27;ul&#x27;</span>, &#123; <span class="attr">id</span>: <span class="string">&#x27;list&#x27;</span> &#125;, [</span><br><span class="line">	<span class="title function_">el</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;item&#x27;</span> &#125;, [<span class="string">&#x27;Item 21&#x27;</span>]),</span><br><span class="line">	<span class="title function_">el</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;item&#x27;</span> &#125;, [<span class="string">&#x27;Item 23&#x27;</span>])</span><br><span class="line">  ]),</span><br><span class="line">  <span class="title function_">el</span>(<span class="string">&#x27;p&#x27;</span>,&#123;&#125;,[<span class="string">&#x27;Hello World&#x27;</span>])</span><br><span class="line">]) </span><br><span class="line"><span class="keyword">var</span> patches = <span class="title function_">diff</span>(ul1,ul2);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;patches:&#x27;</span>,patches);</span><br></pre></td></tr></table></figure>
<img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e1a5bff0b71a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img" style="zoom:50%;" />
<h4 id="2-2-3ã€å°†ä¸¤ä¸ªè™šæ‹Ÿ-DOM-å¯¹è±¡çš„å·®å¼‚åº”ç”¨åˆ°çœŸæ­£çš„-DOM-æ ‘">2.2.3ã€å°†ä¸¤ä¸ªè™šæ‹Ÿ <code>DOM</code> å¯¹è±¡çš„å·®å¼‚åº”ç”¨åˆ°çœŸæ­£çš„ <code>DOM</code> æ ‘<a class="anchor" href="#2-2-3ã€å°†ä¸¤ä¸ªè™šæ‹Ÿ-DOM-å¯¹è±¡çš„å·®å¼‚åº”ç”¨åˆ°çœŸæ­£çš„-DOM-æ ‘">Â·</a></h4>
<h5 id="ï¼ˆ1ï¼‰æ·±åº¦ä¼˜å…ˆéå†-DOM-æ ‘"><strong>ï¼ˆ1ï¼‰æ·±åº¦ä¼˜å…ˆéå† <code>DOM</code> æ ‘</strong><a class="anchor" href="#ï¼ˆ1ï¼‰æ·±åº¦ä¼˜å…ˆéå†-DOM-æ ‘">Â·</a></h5>
<p>â€‹	éå†çš„æ—¶å€™ä»æ­¥éª¤äºŒç”Ÿæˆçš„ <code>patches</code> å¯¹è±¡ä¸­æ‰¾å‡ºå½“å‰éå†çš„èŠ‚ç‚¹å·®å¼‚ï¼Œå¦‚ä¸‹ç›¸å…³ä»£ç æ‰€ç¤ºï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">patch</span> (node, patches) &#123;</span><br><span class="line">  <span class="keyword">var</span> walker = &#123;<span class="attr">index</span>: <span class="number">0</span>&#125;</span><br><span class="line">  <span class="title function_">dfsWalk</span>(node, walker, patches)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">dfsWalk</span> (node, walker, patches) &#123;</span><br><span class="line">  <span class="comment">// ä»patchesæ‹¿å‡ºå½“å‰èŠ‚ç‚¹çš„å·®å¼‚</span></span><br><span class="line">  <span class="keyword">var</span> currentPatches = patches[walker.<span class="property">index</span>]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> len = node.<span class="property">childNodes</span></span><br><span class="line">    ? node.<span class="property">childNodes</span>.<span class="property">length</span></span><br><span class="line">    : <span class="number">0</span></span><br><span class="line">  <span class="comment">// æ·±åº¦éå†å­èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> child = node.<span class="property">childNodes</span>[i]</span><br><span class="line">    walker.<span class="property">index</span>++</span><br><span class="line">    <span class="title function_">dfsWalk</span>(child, walker, patches)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¯¹å½“å‰èŠ‚ç‚¹è¿›è¡ŒDOMæ“ä½œ</span></span><br><span class="line">  <span class="keyword">if</span> (currentPatches) &#123;</span><br><span class="line">    <span class="title function_">applyPatches</span>(node, currentPatches)</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h5 id="ï¼ˆ2ï¼‰å¯¹åŸæœ‰-DOM-æ ‘è¿›è¡Œ-DOM-æ“ä½œ"><strong>ï¼ˆ2ï¼‰å¯¹åŸæœ‰ <code>DOM</code> æ ‘è¿›è¡Œ <code>DOM</code> æ“ä½œ</strong><a class="anchor" href="#ï¼ˆ2ï¼‰å¯¹åŸæœ‰-DOM-æ ‘è¿›è¡Œ-DOM-æ“ä½œ">Â·</a></h5>
<ul>
<li>æ ¹æ®ä¸åŒç±»å‹çš„å·®å¼‚å¯¹å½“å‰èŠ‚ç‚¹è¿›è¡Œä¸åŒçš„ <code>DOM</code> æ“ä½œ</li>
<li>å¦‚æœè¿›è¡Œäº†èŠ‚ç‚¹æ›¿æ¢ï¼Œå°±è¿›è¡ŒèŠ‚ç‚¹æ›¿æ¢ <code>DOM</code> æ“ä½œï¼›å¦‚æœèŠ‚ç‚¹æ–‡æœ¬å‘ç”Ÿäº†æ”¹å˜ï¼Œåˆ™è¿›è¡Œæ–‡æœ¬æ›¿æ¢çš„ <code>DOM</code> æ“ä½œï¼›ä»¥åŠå­èŠ‚ç‚¹é‡æ’ã€å±æ€§æ”¹å˜ç­‰ <code>DOM</code> æ“ä½œ</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">applyPatches</span> (node, currentPatches) &#123;</span><br><span class="line">  currentPatches.<span class="title function_">forEach</span>(<span class="function"><span class="params">currentPatch</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (currentPatch.<span class="property">type</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="attr">REPLACE</span>:</span><br><span class="line">        <span class="keyword">var</span> newNode = (<span class="keyword">typeof</span> currentPatch.<span class="property">node</span> === <span class="string">&#x27;string&#x27;</span>)</span><br><span class="line">          ? <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(currentPatch.<span class="property">node</span>)</span><br><span class="line">          : currentPatch.<span class="property">node</span>.<span class="title function_">render</span>()</span><br><span class="line">        node.<span class="property">parentNode</span>.<span class="title function_">replaceChild</span>(newNode, node)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="attr">REORDER</span>:</span><br><span class="line">        <span class="title function_">reorderChildren</span>(node, currentPatch.<span class="property">moves</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="attr">PROPS</span>:</span><br><span class="line">        <span class="title function_">setProps</span>(node, currentPatch.<span class="property">props</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="attr">TEXT</span>:</span><br><span class="line">        node.<span class="property">textContent</span> = currentPatch.<span class="property">content</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Unknown patch type &#x27;</span> + currentPatch.<span class="property">type</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h5 id="ï¼ˆ3ï¼‰DOMç»“æ„æ”¹å˜"><strong>ï¼ˆ3ï¼‰DOMç»“æ„æ”¹å˜</strong><a class="anchor" href="#ï¼ˆ3ï¼‰DOMç»“æ„æ”¹å˜">Â·</a></h5>
<ul>
<li>é€šè¿‡å°†ç¬¬ 2.2.2 å¾—åˆ°çš„ä¸¤ä¸ª <code>DOM</code> å¯¹è±¡ä¹‹é—´çš„å·®å¼‚ï¼Œåº”ç”¨åˆ°ç¬¬ä¸€ä¸ªï¼ˆåŸå…ˆï¼‰<code>DOM</code> ç»“æ„ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>DOM</code> ç»“æ„è¿›è¡Œäº†é¢„æœŸçš„å˜åŒ–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li>
</ul>
<img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e1ae714e9779?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img" style="zoom: 67%;" />
<h3 id="2-3ã€æ€»ç»“æµç¨‹">2.3ã€æ€»ç»“æµç¨‹<a class="anchor" href="#2-3ã€æ€»ç»“æµç¨‹">Â·</a></h3>
<p><code>Virtual DOM</code> ç®—æ³•ä¸»è¦å®ç°ä¸Šé¢ä¸‰ä¸ªæ­¥éª¤æ¥å®ç°ï¼š</p>
<ul>
<li>
<p>ç”¨ <code>JS</code> å¯¹è±¡æ¨¡æ‹Ÿ <code>DOM</code> æ ‘ â€” <code>element.js</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;virtual-dom&quot;</span>&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Virtual DOM<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span>Item 1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span>Item 2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span>Item 3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt; </span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ¯”è¾ƒä¸¤æ£µè™šæ‹Ÿ <code>DOM</code> æ ‘çš„å·®å¼‚ â€” <code>diff.js</code></p>
<img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e1bb518a2951?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img" style="zoom:50%;" />
</li>
<li>
<p>å°†ä¸¤ä¸ªè™šæ‹Ÿ <code>DOM</code> å¯¹è±¡çš„å·®å¼‚åº”ç”¨åˆ°çœŸæ­£çš„ <code>DOM</code> æ ‘ â€” <code>patch.js</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">applyPatches</span> (node, currentPatches) &#123;</span><br><span class="line">  currentPatches.<span class="title function_">forEach</span>(<span class="function"><span class="params">currentPatch</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (currentPatch.<span class="property">type</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="attr">REPLACE</span>:</span><br><span class="line">        <span class="keyword">var</span> newNode = (<span class="keyword">typeof</span> currentPatch.<span class="property">node</span> === <span class="string">&#x27;string&#x27;</span>)</span><br><span class="line">          ? <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(currentPatch.<span class="property">node</span>)</span><br><span class="line">          : currentPatch.<span class="property">node</span>.<span class="title function_">render</span>()</span><br><span class="line">        node.<span class="property">parentNode</span>.<span class="title function_">replaceChild</span>(newNode, node)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="attr">REORDER</span>:</span><br><span class="line">        <span class="title function_">reorderChildren</span>(node, currentPatch.<span class="property">moves</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="attr">PROPS</span>:</span><br><span class="line">        <span class="title function_">setProps</span>(node, currentPatch.<span class="property">props</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="attr">TEXT</span>:</span><br><span class="line">        node.<span class="property">textContent</span> = currentPatch.<span class="property">content</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Unknown patch type &#x27;</span> + currentPatch.<span class="property">type</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="ä¸‰ã€Virtual-DOM-æºç ç®€æ">ä¸‰ã€<code>Virtual-DOM</code>  æºç ç®€æ<a class="anchor" href="#ä¸‰ã€Virtual-DOM-æºç ç®€æ">Â·</a></h2>
<h3 id="3-1ã€VNode-æ¨¡æ‹Ÿ-DOM-æ ‘">3.1ã€<code>VNode</code> æ¨¡æ‹Ÿ <code>DOM</code> æ ‘<a class="anchor" href="#3-1ã€VNode-æ¨¡æ‹Ÿ-DOM-æ ‘">Â·</a></h3>
<h4 id="3-1-1ã€VNode-ç±»ç®€æ"><strong>3.1.1ã€<code>VNode</code> ç±»ç®€æ</strong><a class="anchor" href="#3-1-1ã€VNode-ç±»ç®€æ">Â·</a></h4>
<ul>
<li>
<p>åœ¨ <code>Vue.js</code> ä¸­ï¼Œ<code>Virtual DOM</code> æ˜¯ç”¨ <code>VNode</code> è¿™ä¸ª <code>Class</code> å»æè¿°ï¼Œå®ƒå®šä¹‰åœ¨ <code>src/core/vdom/vnode.js</code> ä¸­</p>
</li>
<li>
<p>å®é™…ä¸Š <code>Vue.js</code> ä¸­ <code>Virtual DOM</code> æ˜¯å€Ÿé‰´äº†ä¸€ä¸ªå¼€æºåº“  <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsnabbdom%2Fsnabbdom">snabbdom</a> çš„å®ç°ï¼Œç„¶ååŠ å…¥äº†ä¸€äº› <code>Vue.js</code> çš„ä¸€äº›ç‰¹æ€§ã€‚</p>
</li>
<li>
<h4 id="æ ¸å¿ƒå±æ€§ï¼š">æ ¸å¿ƒå±æ€§ï¼š<a class="anchor" href="#æ ¸å¿ƒå±æ€§ï¼š">Â·</a></h4>
<ul>
<li><code>tag</code> å±æ€§å³è¿™ä¸ª<code>vnode</code>çš„æ ‡ç­¾å±æ€§</li>
<li><code>data</code> å±æ€§åŒ…å«äº†æœ€åæ¸²æŸ“æˆçœŸå®<code>dom</code>èŠ‚ç‚¹åï¼ŒèŠ‚ç‚¹ä¸Šçš„<code>class</code>ï¼Œ<code>attribute</code>ï¼Œ<code>style</code>ä»¥åŠç»‘å®šçš„äº‹ä»¶</li>
<li><code>children</code> å±æ€§æ˜¯<code>vnode</code>çš„å­èŠ‚ç‚¹</li>
<li><code>text</code> å±æ€§æ˜¯æ–‡æœ¬å±æ€§</li>
<li><code>elm</code> å±æ€§ä¸ºè¿™ä¸ª<code>vnode</code>å¯¹åº”çš„çœŸå®<code>dom</code>èŠ‚ç‚¹</li>
<li><code>key</code> å±æ€§æ˜¯<code>vnode</code>çš„æ ‡è®°ï¼Œåœ¨<code>diff</code>è¿‡ç¨‹ä¸­å¯ä»¥æé«˜<code>diff</code>çš„æ•ˆç‡</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">VNode</span> &#123;</span><br><span class="line">  <span class="attr">tag</span>: string | <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">data</span>: <span class="title class_">VNodeData</span> | <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">children</span>: ?<span class="title class_">Array</span>&lt;<span class="title class_">VNode</span>&gt;;</span><br><span class="line">  <span class="attr">text</span>: string | <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">elm</span>: <span class="title class_">Node</span> | <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">ns</span>: string | <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">context</span>: <span class="title class_">Component</span> | <span class="keyword">void</span>; <span class="comment">// rendered in this component&#x27;s scope</span></span><br><span class="line">  <span class="attr">key</span>: string | number | <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">componentOptions</span>: <span class="title class_">VNodeComponentOptions</span> | <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">componentInstance</span>: <span class="title class_">Component</span> | <span class="keyword">void</span>; <span class="comment">// component instance</span></span><br><span class="line">  <span class="attr">parent</span>: <span class="title class_">VNode</span> | <span class="keyword">void</span>; <span class="comment">// component placeholder node</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// é™æ€å±æ€§éå¸¸å¤šï¼Œæ­¤å¤„çœç•¥</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span> (</span><br><span class="line">    tag?: string,</span><br><span class="line">    data?: <span class="title class_">VNodeData</span>,</span><br><span class="line">    children?: ?<span class="title class_">Array</span>&lt;<span class="title class_">VNode</span>&gt;,</span><br><span class="line">    text?: string,</span><br><span class="line">    elm?: <span class="title class_">Node</span>,</span><br><span class="line">    context?: <span class="title class_">Component</span>,</span><br><span class="line">    componentOptions?: <span class="title class_">VNodeComponentOptions</span>,</span><br><span class="line">    asyncFactory?: <span class="title class_">Function</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tag</span> = tag</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span> = data</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">children</span> = children</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">text</span> = text</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">elm</span> = elm</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">context</span> = context</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fnContext</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fnOptions</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fnScopeId</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">key</span> = data &amp;&amp; data.<span class="property">key</span></span><br><span class="line">   <span class="comment">// çœç•¥å±æ€§</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-1-2ã€åˆ›å»º-VNode-è¿‡ç¨‹">3.1.2ã€åˆ›å»º <code>VNode</code> è¿‡ç¨‹<a class="anchor" href="#3-1-2ã€åˆ›å»º-VNode-è¿‡ç¨‹">Â·</a></h4>
<h5 id="ï¼ˆ1ï¼‰åˆå§‹åŒ–vue">ï¼ˆ1ï¼‰åˆå§‹åŒ–vue<a class="anchor" href="#ï¼ˆ1ï¼‰åˆå§‹åŒ–vue">Â·</a></h5>
<ul>
<li><code>new Vue( )</code> æ—¶ï¼Œå®é™…ä¸Šæ˜¯æ‰§è¡Œ <code>src/core/instance/index.js</code> ä¸­å®šä¹‰çš„ <code>Function</code> å‡½æ•°</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Vue</span> (options) &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span> &amp;&amp;</span><br><span class="line">    !(<span class="variable language_">this</span> <span class="keyword">instanceof</span> <span class="title class_">Vue</span>)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="title function_">warn</span>(<span class="string">&#x27;Vue is a constructor and should be called with the `new` keyword&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">_init</span>(options)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å†…éƒ¨è°ƒç”¨ <code>this._init</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨ <code>src/core/instance/init.js</code> ä¸­å®šä¹‰</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_init</span> = <span class="keyword">function</span> (<span class="params">options?: <span class="built_in">Object</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">vm</span>: <span class="title class_">Component</span> = <span class="variable language_">this</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">// çœç•¥ä¸€ç³»åˆ—å…¶å®ƒåˆå§‹åŒ–çš„ä»£ç </span></span><br><span class="line">    </span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">$options</span>.<span class="property">el</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;vm.$options.el:&#x27;</span>,vm.<span class="property">$options</span>.<span class="property">el</span>);</span><br><span class="line">    vm.$mount(vm.<span class="property">$options</span>.<span class="property">el</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ï¼ˆ2ï¼‰Vue-å®ä¾‹æŒ‚è½½"><strong>ï¼ˆ2ï¼‰<code>Vue</code> å®ä¾‹æŒ‚è½½</strong><a class="anchor" href="#ï¼ˆ2ï¼‰Vue-å®ä¾‹æŒ‚è½½">Â·</a></h5>
<ul>
<li><code>Vue</code> ä¸­æ˜¯é€šè¿‡ <code>$mount</code> å®ä¾‹æ–¹æ³•å»æŒ‚è½½ <code>dom</code> çš„ï¼Œä¸‹é¢æˆ‘ä»¬é€šè¿‡åˆ†æ <code>compiler</code> ç‰ˆæœ¬çš„ <code>mount</code> å®ç°ï¼Œç›¸å…³æºç åœ¨ç›®å½• <code>src/platforms/web/entry-runtime-with-compiler.js</code> æ–‡ä»¶ä¸­å®šä¹‰ï¼š</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> mount = <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$mount</span></span><br><span class="line"><span class="comment">// é‡å†™</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$mount</span> = <span class="keyword">function</span> (<span class="params"></span></span><br><span class="line"><span class="params">  el?: string | Element,</span></span><br><span class="line"><span class="params">  hydrating?: boolean</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">Component</span> &#123;</span><br><span class="line">  el = el &amp;&amp; <span class="title function_">query</span>(el)</span><br><span class="line">  </span><br><span class="line">   <span class="comment">// çœç•¥ä¸€ç³»åˆ—åˆå§‹åŒ–ä»¥åŠé€»è¾‘åˆ¤æ–­ä»£ç   </span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> mount.<span class="title function_">call</span>(<span class="variable language_">this</span>, el, hydrating)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨ç”¨åŸå…ˆåŸå‹ä¸Šçš„ <code>$mount</code> æ–¹æ³•æŒ‚è½½ ï¼ŒåŸå…ˆåŸå‹ä¸Šçš„ <code>$mount</code> æ–¹æ³•åœ¨ <code>src/platforms/web/runtime/index.js</code> ä¸­å®šä¹‰ ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$mount</span> = <span class="keyword">function</span> (<span class="params"></span></span><br><span class="line"><span class="params">  el?: string | Element,</span></span><br><span class="line"><span class="params">  hydrating?: boolean</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">Component</span> &#123;</span><br><span class="line">  el = el &amp;&amp; inBrowser ? <span class="title function_">query</span>(el) : <span class="literal">undefined</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">mountComponent</span>(<span class="variable language_">this</span>, el, hydrating)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°<code>$mount</code> æ–¹æ³•å®é™…ä¸Šä¼šå»è°ƒç”¨ <code>mountComponent</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å®šä¹‰åœ¨ <code>src/core/instance/lifecycle.js</code> æ–‡ä»¶ä¸­ï¼š</p>
<ul>
<li><code>mountComponent</code> æ ¸å¿ƒå°±æ˜¯å…ˆå®ä¾‹åŒ–ä¸€ä¸ªæ¸²æŸ“<code>Watcher</code>ï¼Œåœ¨å®ƒçš„å›è°ƒå‡½æ•°ä¸­ä¼šè°ƒç”¨ <code>updateComponent</code> æ–¹æ³•</li>
<li>åœ¨æ­¤æ–¹æ³•ä¸­è°ƒç”¨ <code>vm._render</code> æ–¹æ³•å…ˆç”Ÿæˆè™šæ‹Ÿ Nodeï¼Œæœ€ç»ˆè°ƒç”¨ <code>vm._update</code> æ›´æ–° <code>DOM</code>ã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">mountComponent</span> (</span><br><span class="line">  <span class="attr">vm</span>: <span class="title class_">Component</span>,</span><br><span class="line">  <span class="attr">el</span>: ?<span class="title class_">Element</span>,</span><br><span class="line">  hydrating?: boolean</span><br><span class="line">): <span class="title class_">Component</span> &#123;</span><br><span class="line">  vm.<span class="property">$el</span> = el</span><br><span class="line">  <span class="comment">// çœç•¥ä¸€ç³»åˆ—å…¶å®ƒä»£ç </span></span><br><span class="line">  <span class="keyword">let</span> updateComponent</span><br><span class="line">  <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; config.<span class="property">performance</span> &amp;&amp; mark) &#123;</span><br><span class="line">    updateComponent = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// ç”Ÿæˆè™šæ‹Ÿ vnode   </span></span><br><span class="line">      <span class="keyword">const</span> vnode = vm.<span class="title function_">_render</span>()</span><br><span class="line">      <span class="comment">// æ›´æ–° DOM</span></span><br><span class="line">      vm.<span class="title function_">_update</span>(vnode, hydrating)</span><br><span class="line">     </span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    updateComponent = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      vm.<span class="title function_">_update</span>(vm.<span class="title function_">_render</span>(), hydrating)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ä¾‹åŒ–ä¸€ä¸ªæ¸²æŸ“Watcherï¼Œåœ¨å®ƒçš„å›è°ƒå‡½æ•°ä¸­ä¼šè°ƒç”¨ updateComponent æ–¹æ³•  </span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Watcher</span>(vm, updateComponent, noop, &#123;</span><br><span class="line">    before () &#123;</span><br><span class="line">      <span class="keyword">if</span> (vm.<span class="property">_isMounted</span> &amp;&amp; !vm.<span class="property">_isDestroyed</span>) &#123;</span><br><span class="line">        <span class="title function_">callHook</span>(vm, <span class="string">&#x27;beforeUpdate&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="literal">true</span> <span class="comment">/* isRenderWatcher */</span>)</span><br><span class="line">  hydrating = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">return</span> vm</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ï¼ˆ3ï¼‰åˆ›å»ºè™šæ‹Ÿ-Node"><strong>ï¼ˆ3ï¼‰åˆ›å»ºè™šæ‹Ÿ Node</strong><a class="anchor" href="#ï¼ˆ3ï¼‰åˆ›å»ºè™šæ‹Ÿ-Node">Â·</a></h5>
<ul>
<li><code>Vue</code> çš„ <code>_render</code> æ–¹æ³•æ˜¯å®ä¾‹çš„ä¸€ä¸ªç§æœ‰æ–¹æ³•ï¼Œ<strong>å®ƒç”¨æ¥æŠŠå®ä¾‹æ¸²æŸ“æˆä¸€ä¸ªè™šæ‹Ÿ <code>Node</code></strong>ã€‚å®ƒçš„å®šä¹‰åœ¨ <code>src/core/instance/render.js</code> æ–‡ä»¶ä¸­ï¼š</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_render</span> = <span class="keyword">function</span> (<span class="params"></span>): <span class="title class_">VNode</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> <span class="attr">vm</span>: <span class="title class_">Component</span> = <span class="variable language_">this</span>;</span><br><span class="line">   <span class="keyword">const</span> &#123; render, _parentVnode &#125; = vm.<span class="property">$options</span>;</span><br><span class="line">   <span class="keyword">let</span> vnode</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">     <span class="comment">// çœç•¥ä¸€ç³»åˆ—ä»£ç   </span></span><br><span class="line">     currentRenderingInstance = vm;</span><br><span class="line">     <span class="comment">// è°ƒç”¨ createElement æ–¹æ³•æ¥è¿”å› vnode</span></span><br><span class="line">     vnode = render.<span class="title function_">call</span>(vm.<span class="property">_renderProxy</span>, vm.<span class="property">$createElement</span>);</span><br><span class="line">   &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">     <span class="title function_">handleError</span>(<span class="params">e, vm, <span class="string">`render`</span></span>)&#123;&#125;;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// set parent</span></span><br><span class="line">   vnode.<span class="property">parent</span> = _parentVnode;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;vnode...:&quot;</span>,vnode);</span><br><span class="line">   <span class="keyword">return</span> vnode</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>Vue.js</code> åˆ©ç”¨ <code>_createElement</code> æ–¹æ³•åˆ›å»º <code>VNode</code>ï¼Œå®ƒå®šä¹‰åœ¨ <code>src/core/vdom/create-elemenet.js</code> ä¸­ï¼š<code>_createElement</code> æ–¹æ³•æœ‰ 5 ä¸ªå‚æ•°:
<ul>
<li><code>context</code> è¡¨ç¤º VNode çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå®ƒæ˜¯ <code>Component</code> ç±»å‹ï¼›</li>
<li><code>tag</code>è¡¨ç¤ºæ ‡ç­¾ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª <code>Component</code>ï¼›</li>
<li><code>data</code> è¡¨ç¤º VNode çš„æ•°æ®ï¼Œå®ƒæ˜¯ä¸€ä¸ª <code>VNodeData</code> ç±»å‹ï¼Œå¯ä»¥åœ¨ <code>flow/vnode.js</code> ä¸­æ‰¾åˆ°å®ƒçš„å®šä¹‰ï¼›</li>
<li><code>children</code> è¡¨ç¤ºå½“å‰ VNode çš„å­èŠ‚ç‚¹ï¼Œå®ƒæ˜¯ä»»æ„ç±»å‹çš„ï¼Œéœ€è¦è¢«è§„èŒƒä¸ºæ ‡å‡†çš„ <code>VNode</code> æ•°ç»„ï¼›</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">_createElement</span> (</span><br><span class="line">  <span class="attr">context</span>: <span class="title class_">Component</span>,</span><br><span class="line">  tag?: string | <span class="title class_">Class</span>&lt;<span class="title class_">Component</span>&gt; | <span class="title class_">Function</span> | <span class="title class_">Object</span>,</span><br><span class="line">  data?: <span class="title class_">VNodeData</span>,</span><br><span class="line">  children?: any,</span><br><span class="line">  normalizationType?: number</span><br><span class="line">): <span class="title class_">VNode</span> | <span class="title class_">Array</span>&lt;<span class="title class_">VNode</span>&gt; &#123;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">// çœç•¥ä¸€ç³»åˆ—éä¸»çº¿ä»£ç </span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (normalizationType === <span class="variable constant_">ALWAYS_NORMALIZE</span>) &#123;</span><br><span class="line">    <span class="comment">// åœºæ™¯æ˜¯ render å‡½æ•°ä¸æ˜¯ç¼–è¯‘ç”Ÿæˆçš„</span></span><br><span class="line">    children = <span class="title function_">normalizeChildren</span>(children)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (normalizationType === <span class="variable constant_">SIMPLE_NORMALIZE</span>) &#123;</span><br><span class="line">    <span class="comment">// åœºæ™¯æ˜¯ render å‡½æ•°æ˜¯ç¼–è¯‘ç”Ÿæˆçš„</span></span><br><span class="line">    children = <span class="title function_">simpleNormalizeChildren</span>(children)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> vnode, ns</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> tag === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">Ctor</span></span><br><span class="line">    ns = (context.<span class="property">$vnode</span> &amp;&amp; context.<span class="property">$vnode</span>.<span class="property">ns</span>) || config.<span class="title function_">getTagNamespace</span>(tag)</span><br><span class="line">    <span class="keyword">if</span> (config.<span class="title function_">isReservedTag</span>(tag)) &#123;</span><br><span class="line">      <span class="comment">// åˆ›å»ºè™šæ‹Ÿ vnode</span></span><br><span class="line">      vnode = <span class="keyword">new</span> <span class="title class_">VNode</span>(</span><br><span class="line">        config.<span class="title function_">parsePlatformTagName</span>(tag), data, children,</span><br><span class="line">        <span class="literal">undefined</span>, <span class="literal">undefined</span>, context</span><br><span class="line">      )</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((!data || !data.<span class="property">pre</span>) &amp;&amp; <span class="title function_">isDef</span>(<span class="title class_">Ctor</span> = <span class="title function_">resolveAsset</span>(context.<span class="property">$options</span>, <span class="string">&#x27;components&#x27;</span>, tag))) &#123;</span><br><span class="line">      <span class="comment">// component</span></span><br><span class="line">      vnode = <span class="title function_">createComponent</span>(<span class="title class_">Ctor</span>, data, context, children, tag)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      vnode = <span class="keyword">new</span> <span class="title class_">VNode</span>(</span><br><span class="line">        tag, data, children,</span><br><span class="line">        <span class="literal">undefined</span>, <span class="literal">undefined</span>, context</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    vnode = <span class="title function_">createComponent</span>(tag, data, context, children)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(vnode)) &#123;</span><br><span class="line">    <span class="keyword">return</span> vnode</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isDef</span>(vnode)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isDef</span>(ns)) <span class="title function_">applyNS</span>(vnode, ns)</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isDef</span>(data)) <span class="title function_">registerDeepBindings</span>(data)</span><br><span class="line">    <span class="keyword">return</span> vnode</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createEmptyVNode</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-1-3ã€å®ä¾‹æŸ¥çœ‹"><strong>3.1.3ã€å®ä¾‹æŸ¥çœ‹</strong><a class="anchor" href="#3-1-3ã€å®ä¾‹æŸ¥çœ‹">Â·</a></h4>
<ul>
<li>
<h5 id="ä¾‹å¦‚ï¼Œå®ä¾‹åŒ–ä¸€ä¸ª-Vue-å®ä¾‹ï¼š">ä¾‹å¦‚ï¼Œå®ä¾‹åŒ–ä¸€ä¸ª <code>Vue</code> å®ä¾‹ï¼š<a class="anchor" href="#ä¾‹å¦‚ï¼Œå®ä¾‹åŒ–ä¸€ä¸ª-Vue-å®ä¾‹ï¼š">Â·</a></h5>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  <span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">attrs</span>: &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="string">&#x27;app&#x27;</span>,</span><br><span class="line">        <span class="attr">class</span>: <span class="string">&quot;class_box&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;, <span class="variable language_">this</span>.<span class="property">message</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;Hello Vue!&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>æˆ‘ä»¬æ‰“å°å‡ºå…¶å¯¹åº”çš„ <code>VNode</code> è¡¨ç¤ºï¼š</p>
<img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e23b7481b16f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img" style="zoom:50%;" />
</li>
</ul>
<h3 id="3-2ã€diff-è¿‡ç¨‹">3.2ã€<code>diff</code> è¿‡ç¨‹<a class="anchor" href="#3-2ã€diff-è¿‡ç¨‹">Â·</a></h3>
<h4 id="3-2-1ã€Vue-js-æºç çš„-diff-è°ƒç”¨é€»è¾‘">3.2.1ã€<code>Vue.js</code> æºç çš„ <code>diff</code> è°ƒç”¨é€»è¾‘<a class="anchor" href="#3-2-1ã€Vue-js-æºç çš„-diff-è°ƒç”¨é€»è¾‘">Â·</a></h4>
<ul>
<li><code>Vue.js</code> æºç å®ä¾‹åŒ–äº†ä¸€ä¸ª <code>watcher</code>ï¼Œè¿™ä¸ª ~ è¢«æ·»åŠ åˆ°äº†åœ¨æ¨¡æ¿å½“ä¸­æ‰€ç»‘å®šå˜é‡çš„ä¾èµ–å½“ä¸­ï¼Œä¸€æ—¦ <code>model</code> ä¸­çš„å“åº”å¼çš„æ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼Œè¿™äº›å“åº”å¼çš„æ•°æ®æ‰€ç»´æŠ¤çš„ <code>dep</code> æ•°ç»„ä¾¿ä¼šè°ƒç”¨ <code>dep.notify()</code> æ–¹æ³•å®Œæˆæ‰€æœ‰ä¾èµ–éå†æ‰§è¡Œçš„å·¥ä½œï¼Œè¿™åŒ…æ‹¬è§†å›¾çš„æ›´æ–°ï¼Œå³ <code>updateComponent</code> æ–¹æ³•çš„è°ƒç”¨ã€‚</li>
<li><code>watcher</code> å’Œ <code>updateComponent</code>æ–¹æ³•å®šä¹‰åœ¨  <code>src/core/instance/lifecycle.js</code> æ–‡ä»¶ä¸­</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">mountComponent</span> (</span><br><span class="line">  <span class="attr">vm</span>: <span class="title class_">Component</span>,</span><br><span class="line">  <span class="attr">el</span>: ?<span class="title class_">Element</span>,</span><br><span class="line">  hydrating?: boolean</span><br><span class="line">): <span class="title class_">Component</span> &#123;</span><br><span class="line">  vm.<span class="property">$el</span> = el</span><br><span class="line">  <span class="comment">// çœç•¥ä¸€ç³»åˆ—å…¶å®ƒä»£ç </span></span><br><span class="line">  <span class="keyword">let</span> updateComponent</span><br><span class="line">  <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; config.<span class="property">performance</span> &amp;&amp; mark) &#123;</span><br><span class="line">    updateComponent = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// ç”Ÿæˆè™šæ‹Ÿ vnode   </span></span><br><span class="line">      <span class="keyword">const</span> vnode = vm.<span class="title function_">_render</span>()</span><br><span class="line">      <span class="comment">// æ›´æ–° DOM</span></span><br><span class="line">      vm.<span class="title function_">_update</span>(vnode, hydrating)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    updateComponent = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      vm.<span class="title function_">_update</span>(vm.<span class="title function_">_render</span>(), hydrating)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ä¾‹åŒ–ä¸€ä¸ªæ¸²æŸ“Watcherï¼Œåœ¨å®ƒçš„å›è°ƒå‡½æ•°ä¸­ä¼šè°ƒç”¨ updateComponent æ–¹æ³•  </span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Watcher</span>(vm, updateComponent, noop, &#123;</span><br><span class="line">    before () &#123;</span><br><span class="line">      <span class="keyword">if</span> (vm.<span class="property">_isMounted</span> &amp;&amp; !vm.<span class="property">_isDestroyed</span>) &#123;</span><br><span class="line">        <span class="title function_">callHook</span>(vm, <span class="string">&#x27;beforeUpdate&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="literal">true</span> <span class="comment">/* isRenderWatcher */</span>)</span><br><span class="line">  hydrating = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">return</span> vm</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å®Œæˆè§†å›¾çš„æ›´æ–°å·¥ä½œäº‹å®ä¸Šå°±æ˜¯è°ƒç”¨äº†<code>vm._update</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥æ”¶çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åˆšç”Ÿæˆçš„<code>Vnode</code>ï¼Œè°ƒç”¨çš„<code>vm._update</code>æ–¹æ³•å®šä¹‰åœ¨ <code>src/core/instance/lifecycle.js</code>ä¸­</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_update</span> = <span class="keyword">function</span> (<span class="params">vnode: VNode, hydrating?: boolean</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">vm</span>: <span class="title class_">Component</span> = <span class="variable language_">this</span></span><br><span class="line">  <span class="keyword">const</span> prevEl = vm.<span class="property">$el</span></span><br><span class="line">  <span class="keyword">const</span> prevVnode = vm.<span class="property">_vnode</span></span><br><span class="line">  <span class="keyword">const</span> restoreActiveInstance = <span class="title function_">setActiveInstance</span>(vm)</span><br><span class="line">  vm.<span class="property">_vnode</span> = vnode</span><br><span class="line">  <span class="keyword">if</span> (!prevVnode) &#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºçœŸå®çš„nodeèŠ‚ç‚¹ï¼Œåˆ™ä¸ºåˆå§‹åŒ–</span></span><br><span class="line">    vm.<span class="property">$el</span> = vm.<span class="title function_">__patch__</span>(vm.<span class="property">$el</span>, vnode, hydrating, <span class="literal">false</span> <span class="comment">/* removeOnly */</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœéœ€è¦diffçš„prevVnodeå­˜åœ¨ï¼Œé‚£ä¹ˆå¯¹prevVnodeå’Œvnodeè¿›è¡Œdiff</span></span><br><span class="line">    vm.<span class="property">$el</span> = vm.<span class="title function_">__patch__</span>(prevVnode, vnode)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">restoreActiveInstance</span>()</span><br><span class="line">  <span class="comment">// update __vue__ reference</span></span><br><span class="line">  <span class="keyword">if</span> (prevEl) &#123;</span><br><span class="line">    prevEl.<span class="property">__vue__</span> = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">$el</span>) &#123;</span><br><span class="line">    vm.<span class="property">$el</span>.<span class="property">__vue__</span> = vm</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// if parent is an HOC, update its $el as well</span></span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">$vnode</span> &amp;&amp; vm.<span class="property">$parent</span> &amp;&amp; vm.<span class="property">$vnode</span> === vm.<span class="property">$parent</span>.<span class="property">_vnode</span>) &#123;</span><br><span class="line">    vm.<span class="property">$parent</span>.<span class="property">$el</span> = vm.<span class="property">$el</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>åœ¨è¿™ä¸ªæ–¹æ³•å½“ä¸­æœ€ä¸ºå…³é”®çš„å°±æ˜¯ <code>vm.__patch__</code> æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯æ•´ä¸ª <code>virtual-dom</code> å½“ä¸­æœ€ä¸ºæ ¸å¿ƒçš„æ–¹æ³•ï¼Œå®šä¹‰åœ¨ <code>src/core/vdom/patch.js</code> ä¸­</li>
<li>ä¸»è¦å®Œæˆäº†<code>prevVnode</code> å’Œ <code>vnode</code> çš„ <code>diff</code> è¿‡ç¨‹å¹¶æ ¹æ®éœ€è¦æ“ä½œçš„ <code>vdom</code> èŠ‚ç‚¹æ‰“ <code>patch</code>ï¼Œæœ€åç”Ÿæˆæ–°çš„çœŸå® <code>dom</code> èŠ‚ç‚¹å¹¶å®Œæˆè§†å›¾çš„æ›´æ–°å·¥ä½œã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">patch</span> (oldVnode, vnode, hydrating, removeOnly) &#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isUndef</span>(oldVnode)) &#123;</span><br><span class="line">      <span class="comment">// å½“oldVnodeä¸å­˜åœ¨æ—¶ï¼Œåˆ›å»ºæ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">      isInitialPatch = <span class="literal">true</span></span><br><span class="line">      <span class="title function_">createElm</span>(vnode, insertedVnodeQueue)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// å¯¹oldVnodeå’Œvnodeè¿›è¡Œdiffï¼Œå¹¶å¯¹oldVnodeæ‰“patch  </span></span><br><span class="line">      <span class="keyword">const</span> isRealElement = <span class="title function_">isDef</span>(oldVnode.<span class="property">nodeType</span>)</span><br><span class="line">      <span class="keyword">if</span> (!isRealElement &amp;&amp; <span class="title function_">sameVnode</span>(oldVnode, vnode)) &#123;</span><br><span class="line">        <span class="comment">// patch existing root node</span></span><br><span class="line">        <span class="title function_">patchVnode</span>(oldVnode, vnode, insertedVnodeQueue, <span class="literal">null</span>, <span class="literal">null</span>, removeOnly)</span><br><span class="line">      &#125; </span><br><span class="line">	......</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>åœ¨ <code>patch</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ä¼šåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š
<ol>
<li>å½“ <code>oldVnode</code> ä¸å­˜åœ¨æ—¶ï¼Œä¼šåˆ›å»ºæ–°çš„èŠ‚ç‚¹ï¼›</li>
<li>å·²ç»å­˜åœ¨ <code>oldVnode</code> ï¼Œé‚£ä¹ˆä¼šå¯¹ <code>oldVnode</code> å’Œ <code>vnode</code> è¿›è¡Œ <code>diff</code> åŠ <code>patch</code> çš„è¿‡ç¨‹</li>
</ol>
</li>
<li><code>patch</code> è¿‡ç¨‹ä¸­ä¼šè°ƒç”¨ <code>sameVnode</code> æ–¹æ³•æ¥å¯¹å¯¹ä¼ å…¥çš„2ä¸ª <code>vnode</code> è¿›è¡ŒåŸºæœ¬å±æ€§çš„æ¯”è¾ƒï¼Œåªæœ‰å½“åŸºæœ¬å±æ€§ç›¸åŒçš„æƒ…å†µä¸‹æ‰è®¤ä¸ºè¿™ä¸ª2ä¸ª<code>vnode</code> åªæ˜¯å±€éƒ¨å‘ç”Ÿäº†æ›´æ–°ï¼Œç„¶åæ‰ä¼šå¯¹è¿™2ä¸ª <code>vnode</code> è¿›è¡Œ <code>diff</code>ï¼Œ</li>
<li>å¦‚æœ2ä¸ª <code>vnode</code> çš„åŸºæœ¬å±æ€§å­˜åœ¨ä¸ä¸€è‡´çš„æƒ…å†µï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥è·³è¿‡ <code>diff</code> çš„è¿‡ç¨‹ï¼Œè¿›è€Œä¾æ® <code>vnode</code> æ–°å»ºä¸€ä¸ªçœŸå®çš„ <code>dom</code>ï¼ŒåŒæ—¶åˆ é™¤è€çš„ <code>dom</code>èŠ‚ç‚¹</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sameVnode</span> (a, b) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    a.<span class="property">key</span> === b.<span class="property">key</span> &amp;&amp;</span><br><span class="line">    a.<span class="property">tag</span> === b.<span class="property">tag</span> &amp;&amp;</span><br><span class="line">    a.<span class="property">isComment</span> === b.<span class="property">isComment</span> &amp;&amp;</span><br><span class="line">    <span class="title function_">isDef</span>(a.<span class="property">data</span>) === <span class="title function_">isDef</span>(b.<span class="property">data</span>) &amp;&amp;</span><br><span class="line">    <span class="title function_">sameInputType</span>(a, b)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>diff</code> è¿‡ç¨‹ä¸­ä¸»è¦æ˜¯é€šè¿‡è°ƒç”¨ <code>patchVnode</code> æ–¹æ³•è¿›è¡Œçš„:</p>
<h5 id="è€çš„æœ‰ï¼Œæ–°çš„æ²¡æœ‰ï¼Œç›´æ¥å¹²æ‰ï¼›è€çš„æ²¡æœ‰ã€‚æ–°çš„æœ‰ï¼Œæ·»åŠ ï¼›è€çš„æ–°çš„éƒ½æœ‰ï¼Œå¯¹æ¯”å­">è€çš„æœ‰ï¼Œæ–°çš„æ²¡æœ‰ï¼Œç›´æ¥å¹²æ‰ï¼›è€çš„æ²¡æœ‰ã€‚æ–°çš„æœ‰ï¼Œæ·»åŠ ï¼›è€çš„æ–°çš„éƒ½æœ‰ï¼Œå¯¹æ¯”å­<a class="anchor" href="#è€çš„æœ‰ï¼Œæ–°çš„æ²¡æœ‰ï¼Œç›´æ¥å¹²æ‰ï¼›è€çš„æ²¡æœ‰ã€‚æ–°çš„æœ‰ï¼Œæ·»åŠ ï¼›è€çš„æ–°çš„éƒ½æœ‰ï¼Œå¯¹æ¯”å­">Â·</a></h5>
<p>åˆ†äº†å¥½å‡ ç§æƒ…å†µï¼Œ<code>oldCh</code> ä¸º <code>oldVnode</code>çš„å­èŠ‚ç‚¹ï¼Œ<code>ch</code> ä¸º <code>Vnode</code>çš„å­èŠ‚ç‚¹ï¼š</p>
<ul>
<li>é¦–å…ˆè¿›è¡Œæ–‡æœ¬èŠ‚ç‚¹çš„åˆ¤æ–­ï¼Œè‹¥ <code>oldVnode.text !== vnode.text</code>ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥è¿›è¡Œæ–‡æœ¬èŠ‚ç‚¹çš„æ›¿æ¢ï¼›</li>
<li>åœ¨<code>vnode</code> æ²¡æœ‰æ–‡æœ¬èŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼Œè¿›å…¥å­èŠ‚ç‚¹çš„ <code>diff</code>ï¼›</li>
<li>å½“ <code>oldCh</code> å’Œ <code>ch</code> éƒ½å­˜åœ¨ä¸”ä¸ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œè°ƒç”¨ <code>updateChildren</code> å¯¹å­èŠ‚ç‚¹è¿›è¡Œ <code>diff</code>ï¼›</li>
<li>è‹¥ <code>oldCh</code>ä¸å­˜åœ¨ï¼Œ<code>ch</code> å­˜åœ¨ï¼Œé¦–å…ˆæ¸…ç©º <code>oldVnode</code> çš„æ–‡æœ¬èŠ‚ç‚¹ï¼ŒåŒæ—¶è°ƒç”¨ <code>addVnodes</code> æ–¹æ³•å°† <code>ch</code> æ·»åŠ åˆ°<code>elm</code>çœŸå® <code>dom</code> èŠ‚ç‚¹å½“ä¸­ï¼›</li>
<li>è‹¥ <code>oldCh</code>å­˜åœ¨ï¼Œ<code>ch</code>ä¸å­˜åœ¨ï¼Œåˆ™åˆ é™¤ <code>elm</code> çœŸå®èŠ‚ç‚¹ä¸‹çš„ <code>oldCh</code> å­èŠ‚ç‚¹ï¼›</li>
<li>è‹¥ <code>oldVnode</code> æœ‰æ–‡æœ¬èŠ‚ç‚¹ï¼Œè€Œ <code>vnode</code> æ²¡æœ‰ï¼Œé‚£ä¹ˆå°±æ¸…ç©ºè¿™ä¸ªæ–‡æœ¬èŠ‚ç‚¹ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">patchVnode</span> (oldVnode, vnode, insertedVnodeQueue, ownerArray, index, removeOnly) &#123;</span><br><span class="line">  ...... </span><br><span class="line">  <span class="keyword">const</span> elm = vnode.<span class="property">elm</span> = oldVnode.<span class="property">elm</span></span><br><span class="line">  <span class="keyword">const</span> oldCh = oldVnode.<span class="property">children</span></span><br><span class="line">  <span class="keyword">const</span> ch = vnode.<span class="property">children</span></span><br><span class="line">  <span class="comment">// å¦‚æœvnodeæ²¡æœ‰æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isUndef</span>(vnode.<span class="property">text</span>)) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœoldVnodeçš„childrenå±æ€§å­˜åœ¨ä¸”vnodeçš„childrenå±æ€§ä¹Ÿå­˜åœ¨  </span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isDef</span>(oldCh) &amp;&amp; <span class="title function_">isDef</span>(ch)) &#123;</span><br><span class="line">      <span class="comment">// updateChildrenï¼Œå¯¹å­èŠ‚ç‚¹è¿›è¡Œdiff  </span></span><br><span class="line">      <span class="keyword">if</span> (oldCh !== ch) <span class="title function_">updateChildren</span>(elm, oldCh, ch, insertedVnodeQueue, removeOnly)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isDef</span>(ch)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_">checkDuplicateKeys</span>(ch)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// å¦‚æœoldVnodeçš„textå­˜åœ¨ï¼Œé‚£ä¹ˆé¦–å…ˆæ¸…ç©ºtextçš„å†…å®¹,ç„¶åå°†vnodeçš„childrenæ·»åŠ è¿›å»  </span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isDef</span>(oldVnode.<span class="property">text</span>)) nodeOps.<span class="title function_">setTextContent</span>(elm, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">      <span class="title function_">addVnodes</span>(elm, <span class="literal">null</span>, ch, <span class="number">0</span>, ch.<span class="property">length</span> - <span class="number">1</span>, insertedVnodeQueue)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isDef</span>(oldCh)) &#123;</span><br><span class="line">      <span class="comment">// åˆ é™¤elmä¸‹çš„oldchildren</span></span><br><span class="line">      <span class="title function_">removeVnodes</span>(elm, oldCh, <span class="number">0</span>, oldCh.<span class="property">length</span> - <span class="number">1</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isDef</span>(oldVnode.<span class="property">text</span>)) &#123;</span><br><span class="line">      <span class="comment">// oldVnodeæœ‰å­èŠ‚ç‚¹ï¼Œè€Œvnodeæ²¡æœ‰ï¼Œé‚£ä¹ˆå°±æ¸…ç©ºè¿™ä¸ªèŠ‚ç‚¹  </span></span><br><span class="line">      nodeOps.<span class="title function_">setTextContent</span>(elm, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldVnode.<span class="property">text</span> !== vnode.<span class="property">text</span>) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœoldVnodeå’Œvnodeæ–‡æœ¬å±æ€§ä¸åŒï¼Œé‚£ä¹ˆç›´æ¥æ›´æ–°çœŸæ˜¯domèŠ‚ç‚¹çš„æ–‡æœ¬å…ƒç´ </span></span><br><span class="line">    nodeOps.<span class="title function_">setTextContent</span>(elm, vnode.<span class="property">text</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-2-2ã€å­èŠ‚ç‚¹-diff-æµç¨‹åˆ†æ">3.2.2ã€å­èŠ‚ç‚¹ <code>diff</code> æµç¨‹åˆ†æ<a class="anchor" href="#3-2-2ã€å­èŠ‚ç‚¹-diff-æµç¨‹åˆ†æ">Â·</a></h4>
<h5 id="ï¼ˆ1ï¼‰Vue-js-æºç "><strong>ï¼ˆ1ï¼‰<code>Vue.js</code> æºç </strong><a class="anchor" href="#ï¼ˆ1ï¼‰Vue-js-æºç ">Â·</a></h5>
<ul>
<li><code>updateChildren</code>æ–¹æ³•ï¼Œå®ƒä¹Ÿæ˜¯æ•´ä¸ª <code>diff</code> è¿‡ç¨‹ä¸­æœ€é‡è¦çš„ç¯èŠ‚ï¼Œä»¥ä¸‹ä¸º <code>Vue.js</code> çš„æºç è¿‡ç¨‹</li>
<li>**åšæ³•ï¼š**åœ¨å¼€å§‹éå† <code>diff</code> å‰ï¼Œé¦–å…ˆç»™ <code>oldCh</code>å’Œ <code>newCh</code> åˆ†åˆ«åˆ†é…ä¸€ä¸ª <code>startIndex</code> å’Œ <code>endIndex</code> æ¥ä½œä¸ºéå†çš„ç´¢å¼•ï¼Œå½“<code>oldCh</code> æˆ–è€… <code>newCh</code> éå†å®Œå(éå†å®Œçš„æ¡ä»¶å°±æ˜¯ <code>oldCh</code> æˆ–è€… <code>newCh</code> çš„ <code>startIndex &gt;= endIndex</code> )ï¼Œå°±åœæ­¢<code>oldCh</code> å’Œ <code>newCh</code> çš„ <code>diff</code> è¿‡ç¨‹ã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">updateChildren</span> (parentElm, oldCh, newCh, insertedVnodeQueue, removeOnly) &#123;</span><br><span class="line">  <span class="comment">// ä¸ºoldChå’ŒnewChåˆ†åˆ«å»ºç«‹ç´¢å¼•ï¼Œä¸ºä¹‹åéå†çš„ä¾æ®</span></span><br><span class="line">  <span class="keyword">let</span> oldStartIdx = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> newStartIdx = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> oldEndIdx = oldCh.<span class="property">length</span> - <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> oldStartVnode = oldCh[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">let</span> oldEndVnode = oldCh[oldEndIdx]</span><br><span class="line">  <span class="keyword">let</span> newEndIdx = newCh.<span class="property">length</span> - <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> newStartVnode = newCh[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">let</span> newEndVnode = newCh[newEndIdx]</span><br><span class="line">  <span class="keyword">let</span> oldKeyToIdx, idxInOld, vnodeToMove, refElm</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç›´åˆ°oldChæˆ–è€…newChè¢«éå†å®Œåè·³å‡ºå¾ªç¯</span></span><br><span class="line">  <span class="keyword">while</span> (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isUndef</span>(oldStartVnode)) &#123;</span><br><span class="line">      oldStartVnode = oldCh[++oldStartIdx] <span class="comment">// Vnode has been moved left</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isUndef</span>(oldEndVnode)) &#123;</span><br><span class="line">      oldEndVnode = oldCh[--oldEndIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldStartVnode, newStartVnode)) &#123;</span><br><span class="line">      <span class="title function_">patchVnode</span>(oldStartVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)</span><br><span class="line">      oldStartVnode = oldCh[++oldStartIdx]</span><br><span class="line">      newStartVnode = newCh[++newStartIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldEndVnode, newEndVnode)) &#123;</span><br><span class="line">      <span class="title function_">patchVnode</span>(oldEndVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx)</span><br><span class="line">      oldEndVnode = oldCh[--oldEndIdx]</span><br><span class="line">      newEndVnode = newCh[--newEndIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldStartVnode, newEndVnode)) &#123; <span class="comment">// Vnode moved right</span></span><br><span class="line">      <span class="title function_">patchVnode</span>(oldStartVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx)</span><br><span class="line">      canMove &amp;&amp; nodeOps.<span class="title function_">insertBefore</span>(parentElm, oldStartVnode.<span class="property">elm</span>, nodeOps.<span class="title function_">nextSibling</span>(oldEndVnode.<span class="property">elm</span>))</span><br><span class="line">      oldStartVnode = oldCh[++oldStartIdx]</span><br><span class="line">      newEndVnode = newCh[--newEndIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldEndVnode, newStartVnode)) &#123; <span class="comment">// Vnode moved left</span></span><br><span class="line">      <span class="title function_">patchVnode</span>(oldEndVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)</span><br><span class="line">      canMove &amp;&amp; nodeOps.<span class="title function_">insertBefore</span>(parentElm, oldEndVnode.<span class="property">elm</span>, oldStartVnode.<span class="property">elm</span>)</span><br><span class="line">      oldEndVnode = oldCh[--oldEndIdx]</span><br><span class="line">      newStartVnode = newCh[++newStartIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isUndef</span>(oldKeyToIdx)) oldKeyToIdx = <span class="title function_">createKeyToOldIdx</span>(oldCh, oldStartIdx, oldEndIdx)</span><br><span class="line">      idxInOld = <span class="title function_">isDef</span>(newStartVnode.<span class="property">key</span>)</span><br><span class="line">        ? oldKeyToIdx[newStartVnode.<span class="property">key</span>]</span><br><span class="line">        : <span class="title function_">findIdxInOld</span>(newStartVnode, oldCh, oldStartIdx, oldEndIdx)</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isUndef</span>(idxInOld)) &#123; <span class="comment">// New element</span></span><br><span class="line">        <span class="title function_">createElm</span>(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.<span class="property">elm</span>, <span class="literal">false</span>, newCh, newStartIdx)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        vnodeToMove = oldCh[idxInOld]</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(vnodeToMove, newStartVnode)) &#123;</span><br><span class="line">          <span class="title function_">patchVnode</span>(vnodeToMove, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)</span><br><span class="line">          oldCh[idxInOld] = <span class="literal">undefined</span></span><br><span class="line">          canMove &amp;&amp; nodeOps.<span class="title function_">insertBefore</span>(parentElm, vnodeToMove.<span class="property">elm</span>, oldStartVnode.<span class="property">elm</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// same key but different element. treat as new element</span></span><br><span class="line">          <span class="title function_">createElm</span>(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.<span class="property">elm</span>, <span class="literal">false</span>, newCh, newStartIdx)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      newStartVnode = newCh[++newStartIdx]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (oldStartIdx &gt; oldEndIdx) &#123;</span><br><span class="line">    refElm = <span class="title function_">isUndef</span>(newCh[newEndIdx + <span class="number">1</span>]) ? <span class="literal">null</span> : newCh[newEndIdx + <span class="number">1</span>].<span class="property">elm</span></span><br><span class="line">    <span class="title function_">addVnodes</span>(parentElm, refElm, newCh, newStartIdx, newEndIdx, insertedVnodeQueue)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newStartIdx &gt; newEndIdx) &#123;</span><br><span class="line">    <span class="title function_">removeVnodes</span>(parentElm, oldCh, oldStartIdx, oldEndIdx)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ï¼ˆ2ï¼‰æ— -key-çš„-diff-è¿‡ç¨‹"><strong>ï¼ˆ2ï¼‰æ—  <code>key</code> çš„ <code>diff</code> è¿‡ç¨‹</strong><a class="anchor" href="#ï¼ˆ2ï¼‰æ— -key-çš„-diff-è¿‡ç¨‹">Â·</a></h5>
<ul>
<li>é¦–å…ˆä»ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¼€å§‹æ¯”è¾ƒï¼Œä¸ç®¡æ˜¯ <code>oldCh</code> è¿˜æ˜¯ <code>newCh</code> çš„èµ·å§‹æˆ–è€…ç»ˆæ­¢èŠ‚ç‚¹éƒ½ä¸å­˜åœ¨ <code>sameVnode</code> ï¼ŒåŒæ—¶èŠ‚ç‚¹å±æ€§ä¸­æ˜¯ä¸å¸¦ <code>key</code>æ ‡è®°çš„ï¼Œå› æ­¤ç¬¬ä¸€è½®çš„ <code>diff</code> å®Œåï¼Œ<code>newCh</code>çš„ <code>startVnode</code> è¢«æ·»åŠ åˆ° <code>oldStartVnode</code>çš„å‰é¢ï¼ŒåŒæ—¶ <code>newStartIndex</code>å‰ç§»ä¸€ä½ï¼›</li>
</ul>
<img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e0e2878c44dc?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="Ã¥Â›Â¾Ã§Â‰Â‡Ã¦ÂÂÃ¨Â¿Â°" style="zoom:50%;" />
<ul>
<li>ç¬¬äºŒè½®çš„ <code>diff</code>ä¸­ï¼Œæ»¡è¶³ <code>sameVnode(oldStartVnode, newStartVnode)</code>ï¼Œå› æ­¤å¯¹è¿™2ä¸ª <code>vnode</code> è¿›è¡Œ<code>diff</code>ï¼Œæœ€åå°† <code>patch</code> æ‰“åˆ° <code>oldStartVnode</code> ä¸Šï¼ŒåŒæ—¶ <code>oldStartVnode</code>å’Œ <code>newStartIndex</code> éƒ½å‘å‰ç§»åŠ¨ä¸€ä½ ï¼›</li>
</ul>
<img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e0e28889eaff?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="Ã¥Â›Â¾Ã§Â‰Â‡Ã¦ÂÂÃ¨Â¿Â°" style="zoom:50%;" />
<ul>
<li>ç¬¬ä¸‰è½®çš„ <code>diff</code> ä¸­ï¼Œæ»¡è¶³ <code>sameVnode(oldEndVnode, newStartVnode)</code>ï¼Œé‚£ä¹ˆé¦–å…ˆå¯¹ <code>oldEndVnode</code>å’Œ<code>newStartVnode</code> è¿›è¡Œ <code>diff</code>ï¼Œå¹¶å¯¹ <code>oldEndVnode</code>è¿›è¡Œ <code>patch</code>ï¼Œå¹¶å®Œæˆ <code>oldEndVnode</code> ç§»ä½çš„æ“ä½œï¼Œæœ€å<code>newStartIndex</code>å‰ç§»ä¸€ä½ï¼Œ<code>oldStartVnode</code> åç§»ä¸€ä½ï¼›</li>
</ul>
<img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e0e289a351b2?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="Ã¥Â›Â¾Ã§Â‰Â‡Ã¦ÂÂÃ¨Â¿Â°" style="zoom: 50%;" />
<ul>
<li>ç¬¬å››è½®çš„ <code>diff</code>ä¸­ï¼Œè¿‡ç¨‹åŒæ­¥éª¤3ï¼›</li>
</ul>
<img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e0e289f9213e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="Ã¥Â›Â¾Ã§Â‰Â‡Ã¦ÂÂÃ¨Â¿Â°" style="zoom: 33%;" />
<ul>
<li>ç¬¬äº”è½®çš„ <code>diff</code> ä¸­ï¼ŒåŒè¿‡ç¨‹1ï¼›</li>
</ul>
<img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e0e28aee99a1?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="Ã¥Â›Â¾Ã§Â‰Â‡Ã¦ÂÂÃ¨Â¿Â°" style="zoom: 33%;" />
<ul>
<li>éå†çš„è¿‡ç¨‹ç»“æŸåï¼Œ<code>newStartIdx &gt; newEndIdx</code>ï¼Œè¯´æ˜æ­¤æ—¶ <code>oldCh</code> å­˜åœ¨å¤šä½™çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæœ€åå°±éœ€è¦å°†è¿™äº›å¤šä½™çš„èŠ‚ç‚¹åˆ é™¤ã€‚</li>
</ul>
<img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e0e2ca893b49?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="Ã¥Â›Â¾Ã§Â‰Â‡Ã¦ÂÂÃ¨Â¿Â°" style="zoom: 33%;" />
<h5 id="ï¼ˆ3ï¼‰æœ‰-key-çš„-diff-æµç¨‹"><strong>ï¼ˆ3ï¼‰æœ‰ <code>key</code> çš„ <code>diff</code> æµç¨‹</strong><a class="anchor" href="#ï¼ˆ3ï¼‰æœ‰-key-çš„-diff-æµç¨‹">Â·</a></h5>
<ul>
<li>
<p>åœ¨ <code>vnode</code> ä¸å¸¦ <code>key</code> çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸€è½®çš„ <code>diff</code> è¿‡ç¨‹å½“ä¸­éƒ½æ˜¯<code>èµ·å§‹</code>å’Œ<code>ç»“æŸ</code>èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒï¼Œç›´åˆ° <code>oldCh</code> æˆ–è€…<code>newCh</code> è¢«éå†å®Œ</p>
</li>
<li>
<p>å½“ä¸º <code>vnode</code> å¼•å…¥ <code>key</code> å±æ€§åï¼Œåœ¨æ¯ä¸€è½® <code>diff</code> è¿‡ç¨‹ä¸­ï¼Œå½“<code>èµ·å§‹</code>å’Œ<code>ç»“æŸ</code>èŠ‚ç‚¹éƒ½æ²¡æœ‰æ‰¾åˆ°<code>sameVnode</code> æ—¶ï¼Œç„¶ååˆ¤æ–­åœ¨ <code>newStartVnode</code> çš„å±æ€§ä¸­æ˜¯å¦æœ‰ <code>key</code>ï¼Œä¸”æ˜¯å¦åœ¨ <code>oldKeyToIndx</code> ä¸­æ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹ï¼š</p>
<ul>
<li>å¦‚æœä¸å­˜åœ¨è¿™ä¸ª <code>key</code>ï¼Œé‚£ä¹ˆå°±å°†è¿™ä¸ª <code>newStartVnode</code>ä½œä¸ºæ–°çš„èŠ‚ç‚¹åˆ›å»ºä¸”æ’å…¥åˆ°åŸæœ‰çš„ <code>root</code> çš„å­èŠ‚ç‚¹ä¸­ï¼›</li>
<li>å¦‚æœå­˜åœ¨è¿™ä¸ª <code>key</code>ï¼Œé‚£ä¹ˆå°±å–å‡º <code>oldCh</code> ä¸­çš„å­˜åœ¨è¿™ä¸ª <code>key</code> çš„ <code>vnode</code>ï¼Œç„¶åå†è¿›è¡Œ <code>diff</code> çš„è¿‡ï¼›</li>
</ul>
</li>
<li>
<p>æ‰€ä»¥ï¼šéå† <code>diff</code> çš„è¿‡ç¨‹ä¸­ï¼Œå½“<strong>èµ·å§‹ç‚¹</strong>ï¼Œ<strong>ç»“æŸç‚¹</strong>çš„<strong>æœå¯»</strong>åŠ <code>diff</code> å‡ºç°è¿˜æ˜¯æ— æ³•åŒ¹é…çš„æƒ…å†µä¸‹æ—¶ï¼Œå°±ä¼šç”¨ <code>key</code> æ¥ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œæ¥è¿›è¡Œ <code>diff</code>ï¼Œè¿™æ ·å°±å¯ä»¥æé«˜ <code>diff</code> æ•ˆç‡</p>
<p>å¸¦æœ‰ <code>Key</code>å±æ€§çš„ <code>vnode</code>çš„ <code>diff</code> è¿‡ç¨‹å¯è§ä¸‹å›¾ï¼š</p>
<ol>
<li>
<p>é¦–å…ˆä»ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¼€å§‹æ¯”è¾ƒï¼Œä¸ç®¡æ˜¯ <code>oldCh</code> è¿˜æ˜¯ <code>newCh</code> çš„èµ·å§‹æˆ–è€…ç»ˆæ­¢èŠ‚ç‚¹éƒ½ä¸å­˜åœ¨ <code>sameVnode</code>ï¼Œä½†èŠ‚ç‚¹å±æ€§ä¸­æ˜¯å¸¦ <code>key</code> æ ‡è®°çš„ï¼Œ ç„¶ååœ¨ <code>oldKeyToIndx</code> ä¸­æ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹ï¼Œè¿™æ ·ç¬¬ä¸€è½® <code>diff</code> è¿‡å <code>oldCh</code> ä¸Šçš„<code>BèŠ‚ç‚¹</code>è¢«åˆ é™¤äº†ï¼Œä½†æ˜¯ <code>newCh</code> ä¸Šçš„<code>BèŠ‚ç‚¹</code>ä¸Š <code>elm</code> å±æ€§ä¿æŒå¯¹ <code>oldCh</code> ä¸Š <code>BèŠ‚ç‚¹</code> çš„<code>elm</code>å¼•ç”¨</p>
<img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e0e2db1c4812?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="Ã¥Â›Â¾Ã§Â‰Â‡Ã¦ÂÂÃ¨Â¿Â°" style="zoom:50%;" />
</li>
<li>
<p>ç¬¬äºŒè½®çš„ <code>diff</code> ä¸­ï¼Œæ»¡è¶³ <code>sameVnode(oldStartVnode, newStartVnode)</code>ï¼Œå› æ­¤å¯¹è¿™2ä¸ª <code>vnode</code> è¿›è¡Œ<code>diff</code>ï¼Œæœ€åå°† <code>patch</code> æ‰“åˆ° <code>oldStartVnode</code>ä¸Šï¼ŒåŒæ—¶ <code>oldStartVnode</code> å’Œ <code>newStartIndex</code> éƒ½å‘å‰ç§»åŠ¨ä¸€ä½ ï¼›</p>
</li>
</ol>
</li>
</ul>
<img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e0e2d7df4fbf?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="Ã¥Â›Â¾Ã§Â‰Â‡Ã¦ÂÂÃ¨Â¿Â°" style="zoom:50%;" />
<p>â€‹	3. ç¬¬ä¸‰è½®çš„ <code>diff</code>ä¸­ï¼Œæ»¡è¶³ <code>sameVnode(oldEndVnode, newStartVnode)</code>ï¼Œé‚£ä¹ˆé¦–å…ˆå¯¹ <code>oldEndVnode</code> å’Œ<code>newStartVnode</code> è¿›è¡Œ <code>diff</code>ï¼Œå¹¶å¯¹ <code>oldEndVnode</code> è¿›è¡Œ <code>patch</code>ï¼Œå¹¶å®Œæˆ <code>oldEndVnode</code> ç§»ä½çš„æ“ä½œï¼Œæœ€å<code>newStartIndex</code> å‰ç§»ä¸€ä½ï¼Œ<code>oldStartVnode</code>åç§»ä¸€ä½ï¼›</p>
<img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e0e2e2a2835e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="Ã¥Â›Â¾Ã§Â‰Â‡Ã¦ÂÂÃ¨Â¿Â°" style="zoom:50%;" />
<ol start="4">
<li>ç¬¬å››è½®çš„<code>diff</code>ä¸­ï¼Œè¿‡ç¨‹åŒæ­¥éª¤2ï¼›</li>
</ol>
<img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e0e2e507aec0?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="Ã¥Â›Â¾Ã§Â‰Â‡Ã¦ÂÂÃ¨Â¿Â°" style="zoom: 33%;" />
<ol start="5">
<li>ç¬¬äº”è½®çš„<code>diff</code>ä¸­ï¼Œå› ä¸ºæ­¤æ—¶ <code>oldStartIndex</code> å·²ç»å¤§äº <code>oldEndIndex</code>ï¼Œæ‰€ä»¥å°†å‰©ä½™çš„ <code>Vnode</code> é˜Ÿåˆ—æ’å…¥é˜Ÿåˆ—æœ€åã€‚</li>
</ol>
<img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1e0e3178398fc?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="Ã¥Â›Â¾Ã§Â‰Â‡Ã¦ÂÂÃ¨Â¿Â°" style="zoom: 33%;" />
<h3 id="3-3ã€patch-è¿‡ç¨‹">3.3ã€<code>patch</code> è¿‡ç¨‹<a class="anchor" href="#3-3ã€patch-è¿‡ç¨‹">Â·</a></h3>
<p>é€šè¿‡3.2ç« èŠ‚ä»‹ç»çš„ <code>diff</code> è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ° <code>nodeOps</code> ç›¸å…³çš„æ–¹æ³•å¯¹çœŸå® <code>DOM</code> ç»“æ„è¿›è¡Œæ“ä½œï¼Œ<code>nodeOps</code> å®šä¹‰åœ¨ <code>src/platforms/web/runtime/node-ops.js</code> ä¸­ï¼Œå…¶ä¸ºåŸºæœ¬ <code>DOM</code> æ“ä½œï¼Œè¿™é‡Œå°±ä¸åœ¨è¯¦ç»†ä»‹ç»ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createElementNS</span> (<span class="attr">namespace</span>: string, <span class="attr">tagName</span>: string): <span class="title class_">Element</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">createElementNS</span>(namespaceMap[namespace], tagName)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createTextNode</span> (<span class="attr">text</span>: string): <span class="title class_">Text</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(text)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createComment</span> (<span class="attr">text</span>: string): <span class="title class_">Comment</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">createComment</span>(text)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">insertBefore</span> (<span class="attr">parentNode</span>: <span class="title class_">Node</span>, <span class="attr">newNode</span>: <span class="title class_">Node</span>, <span class="attr">referenceNode</span>: <span class="title class_">Node</span>) &#123;</span><br><span class="line">  parentNode.<span class="title function_">insertBefore</span>(newNode, referenceNode)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">removeChild</span> (<span class="attr">node</span>: <span class="title class_">Node</span>, <span class="attr">child</span>: <span class="title class_">Node</span>) &#123;</span><br><span class="line">  node.<span class="title function_">removeChild</span>(child)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>Vueçš„è™šæ‹ŸDOM</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://www.nesxc.com/post/hexocc.html">https://www.nesxc.com/post/hexocc.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>ä½œè€…</h><div class="post-copyright-cc-info"><h>é£å„¿</h></div></div><div class="post-copyright-c"><h>å‘å¸ƒäº</h><div class="post-copyright-cc-info"><h>2021-12-13</h></div></div><div class="post-copyright-u"><h>æ›´æ–°äº</h><div class="post-copyright-cc-info"><h>2023-01-17</h></div></div><div class="post-copyright-c"><h>è®¸å¯åè®®</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post_share"><div class="social-share" data-image="https://images.unsplash.com/photo-1639327771356-e2bde8814883?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1333&amp;q=80" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div id="wpac-rating"></div><script>wpac_init = window.wpac_init || [];
wpac_init.push({widget: 'Rating', id: 33234});
(function() {
  if ('WIDGETPACK_LOADED' in window) return;
  WIDGETPACK_LOADED = true;
  var mc = document.createElement('script');
  mc.type = 'text/javascript';
  mc.async = true;
  //- mc.src = '//embed.widgetpack.com/widget.js';
  var s = document.getElementsByTagName('script')[0];
  s?.parentNode?.insertBefore(mc, s?.nextSibling);
})();</script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/3598970227.html"><img class="prev-cover" src="https://images.unsplash.com/photo-1639330721108-fcce4394f608?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1287&amp;q=80" onerror="onerror=null;src='https://mynightwish.oss-cn-beijing.aliyuncs.com/staticResource/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Vueçš„åŒå‘ç»‘å®š</div></div></a></div><div class="next-post pull-right"><a href="/posts/265724518.html"><img class="next-cover" src="https://images.unsplash.com/photo-1637691068786-e0b2e9186a0e?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=387&amp;q=80" onerror="onerror=null;src='https://mynightwish.oss-cn-beijing.aliyuncs.com/staticResource/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">é¡¹ç›®4:Bå®ä¹ ï¼šé—®é¢˜æ€»ç»“ç¯‡</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%99%9A%E6%8B%9FDOM"><span class="toc-text">è™šæ‹ŸDOM</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%84%89%E7%BB%9C%EF%BC%9A%E4%BB%8E%E5%88%9D%E5%A7%8B%E5%8C%96-Vue-%E5%88%B0%E6%9C%80%E7%BB%88%E6%B8%B2%E6%9F%93%E7%9A%84%E6%95%B4%E4%B8%AA%E8%BF%87%E7%A8%8B"><span class="toc-text">è„‰ç»œï¼šä»åˆå§‹åŒ– Vue åˆ°æœ€ç»ˆæ¸²æŸ“çš„æ•´ä¸ªè¿‡ç¨‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E7%9C%9F%E5%AE%9EDOM%E5%92%8C%E5%85%B6%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B"><span class="toc-text">ä¸€ã€çœŸå®DOMå’Œå…¶è§£ææµç¨‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Virtual-DOM-%E5%9F%BA%E7%A1%80"><span class="toc-text">äºŒã€Virtual-DOM åŸºç¡€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E3%80%81%E8%99%9A%E6%8B%9F-DOM-%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-text">2.1ã€è™šæ‹Ÿ DOM çš„å¥½å¤„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E3%80%81%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0"><span class="toc-text">2.2ã€ç®—æ³•å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1%E3%80%81%E7%94%A8-JS-%E5%AF%B9%E8%B1%A1%E6%A8%A1%E6%8B%9F-DOM-%E6%A0%91"><span class="toc-text">2.2.1ã€ç”¨ JS å¯¹è±¡æ¨¡æ‹Ÿ DOM æ ‘</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%A6%82%E4%BD%95%E7%94%A8-JS-%E5%AF%B9%E8%B1%A1%E6%A8%A1%E6%8B%9F-DOM-%E6%A0%91%EF%BC%9F"><span class="toc-text">ï¼ˆ1ï¼‰å¦‚ä½•ç”¨ JS å¯¹è±¡æ¨¡æ‹Ÿ DOM æ ‘ï¼Ÿ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E6%B8%B2%E6%9F%93%E7%94%A8-JS-%E8%A1%A8%E7%A4%BA%E7%9A%84-DOM-%E5%AF%B9%E8%B1%A1"><span class="toc-text">ï¼ˆ2ï¼‰æ¸²æŸ“ç”¨ JS è¡¨ç¤ºçš„ DOM å¯¹è±¡</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2%E3%80%81%E6%AF%94%E8%BE%83%E4%B8%A4%E6%A3%B5%E8%99%9A%E6%8B%9F-DOM-%E6%A0%91%E7%9A%84%E5%B7%AE%E5%BC%82-%E2%80%94-diff-%E7%AE%97%E6%B3%95"><span class="toc-text">2.2.2ã€æ¯”è¾ƒä¸¤æ£µè™šæ‹Ÿ DOM æ ‘çš„å·®å¼‚ â€” diff ç®—æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%85%88%E9%81%8D%E5%8E%86%EF%BC%8C%E8%AE%B0%E5%BD%95%E5%B7%AE%E5%BC%82"><span class="toc-text">ï¼ˆ1ï¼‰æ·±åº¦ä¼˜å…ˆéå†ï¼Œè®°å½•å·®å¼‚</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E5%B7%AE%E5%BC%82%E7%B1%BB%E5%9E%8B"><span class="toc-text">ï¼ˆ2ï¼‰å·®å¼‚ç±»å‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E5%88%97%E8%A1%A8%E5%AF%B9%E6%AF%94%E7%AE%97%E6%B3%95-%E4%B8%8D%E8%A6%81%E4%B8%BB%E5%8A%A8%E6%8F%90"><span class="toc-text">ï¼ˆ3ï¼‰åˆ—è¡¨å¯¹æ¯”ç®—æ³•                   ä¸è¦ä¸»åŠ¨æ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%884%EF%BC%89%E5%AE%9E%E4%BE%8B%E8%BE%93%E5%87%BA"><span class="toc-text">ï¼ˆ4ï¼‰å®ä¾‹è¾“å‡º</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3%E3%80%81%E5%B0%86%E4%B8%A4%E4%B8%AA%E8%99%9A%E6%8B%9F-DOM-%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%B7%AE%E5%BC%82%E5%BA%94%E7%94%A8%E5%88%B0%E7%9C%9F%E6%AD%A3%E7%9A%84-DOM-%E6%A0%91"><span class="toc-text">2.2.3ã€å°†ä¸¤ä¸ªè™šæ‹Ÿ DOM å¯¹è±¡çš„å·®å¼‚åº”ç”¨åˆ°çœŸæ­£çš„ DOM æ ‘</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%85%88%E9%81%8D%E5%8E%86-DOM-%E6%A0%91"><span class="toc-text">ï¼ˆ1ï¼‰æ·±åº¦ä¼˜å…ˆéå† DOM æ ‘</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E5%AF%B9%E5%8E%9F%E6%9C%89-DOM-%E6%A0%91%E8%BF%9B%E8%A1%8C-DOM-%E6%93%8D%E4%BD%9C"><span class="toc-text">ï¼ˆ2ï¼‰å¯¹åŸæœ‰ DOM æ ‘è¿›è¡Œ DOM æ“ä½œ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%883%EF%BC%89DOM%E7%BB%93%E6%9E%84%E6%94%B9%E5%8F%98"><span class="toc-text">ï¼ˆ3ï¼‰DOMç»“æ„æ”¹å˜</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3%E3%80%81%E6%80%BB%E7%BB%93%E6%B5%81%E7%A8%8B"><span class="toc-text">2.3ã€æ€»ç»“æµç¨‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Virtual-DOM-%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90"><span class="toc-text">ä¸‰ã€Virtual-DOM  æºç ç®€æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%E3%80%81VNode-%E6%A8%A1%E6%8B%9F-DOM-%E6%A0%91"><span class="toc-text">3.1ã€VNode æ¨¡æ‹Ÿ DOM æ ‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1%E3%80%81VNode-%E7%B1%BB%E7%AE%80%E6%9E%90"><span class="toc-text">3.1.1ã€VNode ç±»ç®€æ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%B1%9E%E6%80%A7%EF%BC%9A"><span class="toc-text">æ ¸å¿ƒå±æ€§ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2%E3%80%81%E5%88%9B%E5%BB%BA-VNode-%E8%BF%87%E7%A8%8B"><span class="toc-text">3.1.2ã€åˆ›å»º VNode è¿‡ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%88%9D%E5%A7%8B%E5%8C%96vue"><span class="toc-text">ï¼ˆ1ï¼‰åˆå§‹åŒ–vue</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%882%EF%BC%89Vue-%E5%AE%9E%E4%BE%8B%E6%8C%82%E8%BD%BD"><span class="toc-text">ï¼ˆ2ï¼‰Vue å®ä¾‹æŒ‚è½½</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F-Node"><span class="toc-text">ï¼ˆ3ï¼‰åˆ›å»ºè™šæ‹Ÿ Node</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3%E3%80%81%E5%AE%9E%E4%BE%8B%E6%9F%A5%E7%9C%8B"><span class="toc-text">3.1.3ã€å®ä¾‹æŸ¥çœ‹</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BE%8B%E5%A6%82%EF%BC%8C%E5%AE%9E%E4%BE%8B%E5%8C%96%E4%B8%80%E4%B8%AA-Vue-%E5%AE%9E%E4%BE%8B%EF%BC%9A"><span class="toc-text">ä¾‹å¦‚ï¼Œå®ä¾‹åŒ–ä¸€ä¸ª Vue å®ä¾‹ï¼š</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2%E3%80%81diff-%E8%BF%87%E7%A8%8B"><span class="toc-text">3.2ã€diff è¿‡ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1%E3%80%81Vue-js-%E6%BA%90%E7%A0%81%E7%9A%84-diff-%E8%B0%83%E7%94%A8%E9%80%BB%E8%BE%91"><span class="toc-text">3.2.1ã€Vue.js æºç çš„ diff è°ƒç”¨é€»è¾‘</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%80%81%E7%9A%84%E6%9C%89%EF%BC%8C%E6%96%B0%E7%9A%84%E6%B2%A1%E6%9C%89%EF%BC%8C%E7%9B%B4%E6%8E%A5%E5%B9%B2%E6%8E%89%EF%BC%9B%E8%80%81%E7%9A%84%E6%B2%A1%E6%9C%89%E3%80%82%E6%96%B0%E7%9A%84%E6%9C%89%EF%BC%8C%E6%B7%BB%E5%8A%A0%EF%BC%9B%E8%80%81%E7%9A%84%E6%96%B0%E7%9A%84%E9%83%BD%E6%9C%89%EF%BC%8C%E5%AF%B9%E6%AF%94%E5%AD%90"><span class="toc-text">è€çš„æœ‰ï¼Œæ–°çš„æ²¡æœ‰ï¼Œç›´æ¥å¹²æ‰ï¼›è€çš„æ²¡æœ‰ã€‚æ–°çš„æœ‰ï¼Œæ·»åŠ ï¼›è€çš„æ–°çš„éƒ½æœ‰ï¼Œå¯¹æ¯”å­</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2%E3%80%81%E5%AD%90%E8%8A%82%E7%82%B9-diff-%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90"><span class="toc-text">3.2.2ã€å­èŠ‚ç‚¹ diff æµç¨‹åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%881%EF%BC%89Vue-js-%E6%BA%90%E7%A0%81"><span class="toc-text">ï¼ˆ1ï¼‰Vue.js æºç </span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E6%97%A0-key-%E7%9A%84-diff-%E8%BF%87%E7%A8%8B"><span class="toc-text">ï¼ˆ2ï¼‰æ—  key çš„ diff è¿‡ç¨‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E6%9C%89-key-%E7%9A%84-diff-%E6%B5%81%E7%A8%8B"><span class="toc-text">ï¼ˆ3ï¼‰æœ‰ key çš„ diff æµç¨‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3%E3%80%81patch-%E8%BF%87%E7%A8%8B"><span class="toc-text">3.3ã€patch è¿‡ç¨‹</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2023 By é£å„¿</div><div id="running-time"></div><div class="footer_custom_text"><p><a style="margin-inline:5px"target="_blank" href="https://hexo.io/"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="åšå®¢æ¡†æ¶ä¸º Hexo" alt="HEXO"></a><a style="margin-inline:5px"target="_blank" href="https://butterfly.js.org/"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="ä¸»é¢˜é‡‡ç”¨ Butterfly" alt="Butterfly"></a><a style="margin-inline:5px"target="_blank" href="https://www.jsdelivr.com/"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="æœ¬ç«™ä½¿ç”¨ Jsdelivr ä¸ºé™æ€èµ„æºæä¾›CDNåŠ é€Ÿ" alt="Jsdelivr"></a><a style="margin-inline:5px"target="_blank" href="https://github.com/"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="æœ¬ç«™é¡¹ç›®ç”± GitHub æ‰˜ç®¡" alt="GitHub"></a><a style="margin-inline:5px"target="_blank"href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" alt="img" title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="to_comment" type="button" title="ç›´è¾¾è¯„è®º" onclick="FixedCommentBtn();"><i class="fas fa-comments"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="ç›´è¾¾åº•éƒ¨" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">æœ¬åœ°æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo-hexo-vert.vercel.app/',
      region: ''
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'https://twikoo-hexo-vert.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><div defer class="aplayer no-destroy" data-id="31872922" data-server="netease" data-type="artist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="false" muted></div><script async data-pjax src="https://cdn.jsdelivr.net/npm/hexo-beautiful-page@latest/lib/asyncmodel.min.js"></script><div id="live3d" class="live3d" style="position: fixed; left: -110px; bottom: 30px;z-index: 98;"><canvas id="live2dm" class="live3d"style="max-width:500px;max-height:437.5px;"></canvas></div><script defer data-pjax src="/js/bottomTime.js"></script><script defer data-pjax src="/js/nav.js"></script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer src="/js/cursor.js"></script><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/emoji.js"></script><script defer data-pjax src="/js/sun_moon.js" async></script><script defer src="https://cdn1.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="//at.alicdn.com/t/c/font_3859043_rw1ayonelb.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer data-pjax src="/js/meihua.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '#web_bg',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.removeEventListener('scroll', window.tocScrollFn)
  window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://mynightwish.online/categories/1-1-CSS/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸŒ° CSS<br>(17)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://mynightwish.online/categories/1-2-JS/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¥‘ JSã€ES<br>(29)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://mynightwish.online/categories/1-3-Ajax/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¥ Ajaxã€Axios<br>(3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://mynightwish.online/categories/1-4-æ¡†æ¶/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¡ Reactã€Vue<br>(15)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://mynightwish.online/categories/2-1-ç»„ä»¶åº“/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ‰ ç»„ä»¶åº“å¼€å‘<br>(1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://mynightwish.online/categories/2-2-åŸºå»º/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¹ é¡¹ç›®åŸºå»º<br>(5)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://mynightwish.online/categories/2-3-å®ç°Tricks/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ’« ç§¯ç´¯åŠŸèƒ½<br>(4)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://mynightwish.online/categories/2-4-é¡¹ç›®/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ”® é¡¹ç›®æ€»ç»“<br>(12)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://mynightwish.online/categories/3-1-è®°å½•/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ‘» ç¢ç¢å¿µ~<br>(3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://mynightwish.online/categories/3-2-æµè§ˆå™¨/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ’¡ æµè§ˆå™¨æ¸²æŸ“<br>(8)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://mynightwish.online/categories/3-3-åŸºç¡€/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ§Š ç½‘ç»œ<br>(10)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://mynightwish.online/categories/3-4-Tool/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¤ å·¥å…·ã€è„šæœ¬<br>(1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="https://mynightwish.online/categories" style="flex:1;text-align: center;margin-bottom: 10px;">æŸ¥çœ‹æ›´å¤š...</a></div></div>';
    console.log('å·²æŒ‚è½½magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(25% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #b30070}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/2621268747.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://mynightwish.oss-cn-beijing.aliyuncs.com/React/react-virtualDom.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-12-13</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/2621268747.html&quot;);" href="javascript:void(0);" alt="">Reactçš„è™šæ‹ŸDOM</a><div class="blog-slider__text">å…„å¼Ÿç¯‡Reactçš„è™šæ‹ŸDOMï¼ŒåŒ…æ‹¬äº†æ ˆè°ƒå’Œ</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/2621268747.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/ReactHooks.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://mynightwish.oss-cn-beijing.aliyuncs.com/React/hook1.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-12-11</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/ReactHooks.html&quot;);" href="javascript:void(0);" alt="">React-Hookçš„å‡ºç°</a><div class="blog-slider__text">ä¸ºä½•Hooksæ˜¯Reactçš„æœªæ¥</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/ReactHooks.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/656350506.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://mynightwish.oss-cn-beijing.aliyuncs.com/CSS/æµè§ˆå™¨å¼‚æ­¥.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-12-11</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/656350506.html&quot;);" href="javascript:void(0);" alt="">JSçš„EventLoop</a><div class="blog-slider__text">å¼‚æ­¥ä¸åŒæ­¥ã€å®ä»»åŠ¡ã€å¾®ä»»åŠ¡</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/656350506.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/3384747987.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTfnIl0f3oUJLgGFb7Qgi97y1hY9uIQsHizXQ&amp;usqp=CAU" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-12-11</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/3384747987.html&quot;);" href="javascript:void(0);" alt="">JSçš„å¼‚æ­¥è§£å†³æ–¹æ¡ˆ</a><div class="blog-slider__text">å‰ç«¯å¼‚æ­¥ä¹‹è·¯</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/3384747987.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('å·²æŒ‚è½½butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="/js/swiperFix.js"></script><!-- hexo injector body_end end --><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>